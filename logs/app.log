2025-11-05 15:25:12 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:25:14 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:25:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:25:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:25:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:17 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:17 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:18 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:18 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:18 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:18 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 15:31:18 | INFO     | __main__:main:88 - Estrutura de diretórios verificada:
2025-11-05 15:31:18 | INFO     | __main__:main:99 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-05 15:31:18 | INFO     | watcher:detect_and_move_jobs:148 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-05 15:38:48 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 15:38:48 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 15:38:48 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 15:38:48 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 15:38:48 | ERROR    | watcher:process_job:133 - Erro ao processar job job_bmf_turismo_001: Arquivos listados no manifest não encontrados: ['cartao_cnpj.pdf']
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D075EB2340>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001D075EB20C0>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001D078F72930>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001D078FF9BC0>
    └ ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='053700ac-544f-4eee-9650-ed063efafaf8', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
        └ <function exec_func_with_error_handling at 0x000001D078FB0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001D019B11080, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000001D02C1D19E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001D02C284360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000001D02C2842C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 97, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_001')
               └ <function load_manifest at 0x000001D02C1D31A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 253, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['cartao_cnpj.pdf']"

RuntimeError: Arquivos listados no manifest não encontrados: ['cartao_cnpj.pdf']
2025-11-05 15:38:48 | ERROR    | watcher:_move_to_error:79 - Job job_bmf_turismo_001 movido para /error/
2025-11-05 15:42:34 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 15:42:34 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 15:42:34 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 15:42:34 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 15:42:34 | ERROR    | watcher:process_job:133 - Erro ao processar job job_bmf_turismo_001: Arquivos listados no manifest não encontrados: ['cartao_cnpj (12)']
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D075EB2340>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001D075EB20C0>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001D078F72930>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001D078FF9BC0>
    └ ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='053700ac-544f-4eee-9650-ed063efafaf8', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
        └ <function exec_func_with_error_handling at 0x000001D078FB0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001D019B11080, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000001D02C1D19E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001D02C284360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000001D02C2842C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 97, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_001')
               └ <function load_manifest at 0x000001D02C1D31A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 253, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['cartao_cnpj (12)']"

RuntimeError: Arquivos listados no manifest não encontrados: ['cartao_cnpj (12)']
2025-11-05 15:42:34 | ERROR    | watcher:_move_to_error:79 - Job job_bmf_turismo_001 movido para /error/
2025-11-05 15:44:19 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 15:44:19 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 15:44:19 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 15:44:19 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 15:44:19 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 15:44:19 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 15:44:19 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 15:44:19 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 15:44:59 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 15:44:59 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-05 15:49:09 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-11-05 15:49:09 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-11-05 15:49:58 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-11-05 15:49:58 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 15:49:58 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 15:49:58 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 15:50:02 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D075EB2340>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001D075EB20C0>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001D078F72930>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001D078FF9BC0>
    └ ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='053700ac-544f-4eee-9650-ed063efafaf8', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
        └ <function exec_func_with_error_handling at 0x000001D078FB0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001D019B11080, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000001D02C1D19E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001D02C284360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000001D02C2842C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 107, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result["dados_extraidos"], manifest, modo="padrao")
                 │                         │       │                              └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'status': 'OK', 'job_id': 'job_bmf_turismo_001', 'evidencias_dir': 'evidencias\\ocr\\job_bmf_turismo_001', 'dados_extraidos'...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000001D02C1D37E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x000001D02E530360>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001D02E020EC0>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000001D02E021010>
                 └ <openai.OpenAI object at 0x000001D07AC01950>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '# Prompt Oficial — PJ (Societária)\nVersão: 2410\nAgente...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001D02E020EC0>,)
           └ <function Completions.create at 0x000001D02E530220>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001D07AC01950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001D02E020EC0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001D02BF49C60>
           │    │          └ <openai.OpenAI object at 0x000001D07AC01950>
           │    └ ~ResponseT
           └ <function cast at 0x000001D075F093A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001D02BF48400>
          └ <openai.OpenAI object at 0x000001D07AC01950>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 15:50:02 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 15:50:02 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 15:50:02 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 15:50:02 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 15:50:02 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 15:50:02 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 15:50:02 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001D075EB2340>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001D075EB20C0>
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 20908)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 20908)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001D078F72930>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001D078FF9BC0>
    └ ScriptRunner(_session_id='053700ac-544f-4eee-9650-ed063efafaf8', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='053700ac-544f-4eee-9650-ed063efafaf8', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
        └ <function exec_func_with_error_handling at 0x000001D078FB0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001D02C1D2520>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001D019B11080, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000001D02C1D19E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001D02C284360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000001D02C2842C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 122, in process_job
    ia2_result = validar_documentos_openai(job_id, ia2_input, manifest, modo="comparativo")
                 │                         │       │          └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'dados_ocr': "\n\n# cartao_cnpj.pdf (Docling)\n<!-- image -->\n\n## REPÚBLICA FEDERATIVA DO BRASIL\n\n## CADASTRO NACIONAL D...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000001D02C1D37E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x000001D02E530360>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001D02E020EC0>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000001D02E021010>
                 └ <openai.OpenAI object at 0x000001D07AC01950>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '# Prompt Oficial — PJ (Societária)\nVersão: 2410\nAgente...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001D02E020EC0>,)
           └ <function Completions.create at 0x000001D02E530220>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001D07AC01950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001D02E020EC0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001D02BF49C60>
           │    │          └ <openai.OpenAI object at 0x000001D07AC01950>
           │    └ ~ResponseT
           └ <function cast at 0x000001D075F093A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001D02BF48400>
          └ <openai.OpenAI object at 0x000001D07AC01950>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 15:50:02 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 15:50:02 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 15:50:02 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 15:50:02 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 15:50:02 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 16:10:18 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:10:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:10:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:10:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:10:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:10:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:10:20 | INFO     | __main__:main:88 - Estrutura de diretórios verificada:
2025-11-05 16:10:20 | INFO     | __main__:main:93 - Modo DEBUG ativado
2025-11-05 16:10:20 | ERROR    | __main__:executar_pipeline_manual:49 - Manifesto não encontrado para o job job_bmf_turismo_001
2025-11-05 16:17:32 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:17:33 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:17:33 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:17:33 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:17:33 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:17:33 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 16:17:33 | INFO     | __main__:main:88 - Estrutura de diretórios verificada:
2025-11-05 16:17:33 | INFO     | __main__:main:99 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-05 16:17:33 | INFO     | watcher:detect_and_move_jobs:148 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-05 16:18:03 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 16:18:03 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_002
2025-11-05 16:18:03 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_002 movido para /processing
2025-11-05 16:18:03 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 16:18:03 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_002' → 'manifest.normalizado.json'
2025-11-05 16:18:03 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_002
2025-11-05 16:18:03 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 16:18:03 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 16:18:08 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 16:18:08 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-05 16:21:15 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-11-05 16:21:15 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-11-05 16:21:54 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-11-05 16:21:54 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 16:21:54 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 16:21:54 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 16:21:55 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_002')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 107, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result["dados_extraidos"], manifest, modo="padrao")
                 │                         │       │                              └ {'job_id': 'job_bmf_turismo_002', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'status': 'OK', 'job_id': 'job_bmf_turismo_002', 'evidencias_dir': 'evidencias\\ocr\\job_bmf_turismo_002', 'dados_extraidos'...
                 │                         └ 'job_bmf_turismo_002'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 16:21:55 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 16:21:55 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 16:21:55 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 16:21:55 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 16:21:55 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 16:21:55 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 16:21:55 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_002')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 122, in process_job
    ia2_result = validar_documentos_openai(job_id, ia2_input, manifest, modo="comparativo")
                 │                         │       │          └ {'job_id': 'job_bmf_turismo_002', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'dados_ocr': "\n\n# cartao_cnpj.pdf (Docling)\n<!-- image -->\n\n## REPÚBLICA FEDERATIVA DO BRASIL\n\n## CADASTRO NACIONAL D...
                 │                         └ 'job_bmf_turismo_002'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 16:21:55 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 16:21:55 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 16:21:55 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_002\resultado
2025-11-05 16:21:55 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 16:21:55 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_002 movido para /done/
2025-11-05 16:30:41 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 16:30:41 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_002
2025-11-05 16:30:41 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_002 movido para /processing
2025-11-05 16:30:41 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 16:30:41 | ERROR    | watcher:process_job:133 - Erro ao processar job job_bmf_turismo_002: Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_002')
    └ <function process_job at 0x000002322D5ECF40>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 97, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_002')
               └ <function load_manifest at 0x000002327CC3C2C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 253, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']"

RuntimeError: Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']
2025-11-05 16:30:41 | ERROR    | watcher:_move_to_error:79 - Job job_bmf_turismo_002 movido para /error/
2025-11-05 16:32:46 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 16:32:46 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 16:32:46 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 16:32:46 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 16:32:46 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 16:32:46 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 16:32:46 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 16:32:46 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 16:33:13 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 16:33:13 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-05 16:36:15 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-11-05 16:36:15 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-11-05 16:36:56 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-11-05 16:36:56 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 16:36:56 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 16:36:56 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 16:36:56 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 107, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result["dados_extraidos"], manifest, modo="padrao")
                 │                         │       │                              └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'status': 'OK', 'job_id': 'job_bmf_turismo_001', 'evidencias_dir': 'evidencias\\ocr\\job_bmf_turismo_001', 'dados_extraidos'...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 16:36:56 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 16:36:56 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 16:36:56 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 16:36:56 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 16:36:56 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 16:36:56 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 16:36:56 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 122, in process_job
    ia2_result = validar_documentos_openai(job_id, ia2_input, manifest, modo="comparativo")
                 │                         │       │          └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'dados_ocr': "\n\n# cartao_cnpj.pdf (Docling)\n<!-- image -->\n\n## REPÚBLICA FEDERATIVA DO BRASIL\n\n## CADASTRO NACIONAL D...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 16:36:56 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 16:36:56 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 16:36:56 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 16:36:56 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 16:36:56 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 16:40:37 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 16:40:37 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 16:40:37 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 16:40:37 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 16:40:37 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 16:40:37 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 16:40:37 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 16:40:37 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 16:41:01 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 16:41:01 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-05 16:44:08 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-11-05 16:44:08 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-11-05 16:44:44 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-11-05 16:44:44 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 16:44:44 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 16:44:44 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 16:44:45 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 107, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result["dados_extraidos"], manifest, modo="padrao")
                 │                         │       │                              └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'status': 'OK', 'job_id': 'job_bmf_turismo_001', 'evidencias_dir': 'evidencias\\ocr\\job_bmf_turismo_001', 'dados_extraidos'...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 16:44:45 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 16:44:45 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 16:44:45 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 16:44:45 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 16:44:45 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 16:44:45 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 16:44:45 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 122, in process_job
    ia2_result = validar_documentos_openai(job_id, ia2_input, manifest, modo="comparativo")
                 │                         │       │          └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'dados_ocr': "\n\n# cartao_cnpj.pdf (Docling)\n<!-- image -->\n\n## REPÚBLICA FEDERATIVA DO BRASIL\n\n## CADASTRO NACIONAL D...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 16:44:45 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 16:44:45 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 16:44:45 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 16:44:45 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 16:44:45 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 18:21:48 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 18:21:48 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 18:21:48 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 18:21:48 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 18:21:48 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 18:21:48 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 18:21:48 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 18:21:48 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 18:22:14 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 18:22:14 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 18:22:14 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 18:22:14 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 18:22:14 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 107, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result["dados_extraidos"], manifest, modo="padrao")
                 │                         │       │                              └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'status': 'OK', 'job_id': 'job_bmf_turismo_001', 'evidencias_dir': 'evidencias\\ocr\\job_bmf_turismo_001', 'dados_extraidos'...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 18:22:14 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 18:22:14 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 18:22:14 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 18:22:14 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 18:22:14 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 18:22:14 | INFO     | doc_verifier_agent:validar_documentos_openai:67 - Enviando análise para OpenAI (PJ)...
2025-11-05 18:22:15 | ERROR    | doc_verifier_agent:validar_documentos_openai:115 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023277D12340>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023277D120C0>
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21160)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21160)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002327AD929D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002327AE19BC0>
    └ ScriptRunner(_session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='408e812b-97b6-4cc8-adec-2f0efa11dee1', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
        └ <function exec_func_with_error_handling at 0x000002327ADD0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002327B9756C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002327A5E9BE0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 103, in <module>
    main()
    └ <function main at 0x000002327C9F6160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 100, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000002322D5ECFE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 155, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_001')
    └ <function process_job at 0x000002322D5ECF40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 122, in process_job
    ia2_result = validar_documentos_openai(job_id, ia2_input, manifest, modo="comparativo")
                 │                         │       │          └ {'job_id': 'job_bmf_turismo_001', 'fornecedor_id': '22157088000192', 'perfil_validacao': 'PJ', 'contexto': {'razao_social': '...
                 │                         │       └ {'dados_ocr': '\n\n# cartao_cnpj.pdf (Docling)\n<!-- image -->\n\n## REPÚBLICA FEDERATIVA DO BRASIL\n\n## CADASTRO NACIONAL D...
                 │                         └ 'job_bmf_turismo_001'
                 └ <function validar_documentos_openai at 0x000002322D5339C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 70, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000023230536A20>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002322EF586E0>
                 └ <openai.OpenAI object at 0x000002320D3ABCB0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5-turbo', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>,)
           └ <function Completions.create at 0x00000232305368E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002320D3ABCB0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002322EF58440>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000002322D3D13A0>
           │    │          └ <openai.OpenAI object at 0x000002320D3ABCB0>
           │    └ ~ResponseT
           └ <function cast at 0x0000023277D693A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000002322D3CBB00>
          └ <openai.OpenAI object at 0x000002320D3ABCB0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2025-11-05 18:22:15 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 18:22:15 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 18:22:15 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 18:22:15 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 18:22:15 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | __main__:main:114 - Estrutura de diretórios verificada:
2025-11-05 18:37:05 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:37:05 | INFO     | __main__:main:114 - Estrutura de diretórios verificada:
2025-11-05 18:37:05 | INFO     | __main__:main:125 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-05 18:37:05 | INFO     | watcher:detect_and_move_jobs:148 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-05 18:37:05 | INFO     | __main__:main:125 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-05 18:37:05 | INFO     | watcher:detect_and_move_jobs:148 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-05 18:37:55 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 18:37:55 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 18:37:55 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 18:37:55 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 18:37:55 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 18:37:55 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 18:37:55 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 18:37:55 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 18:37:59 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 18:37:59 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 18:37:59 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 18:37:59 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 18:38:22 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-05 18:38:22 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 18:38:22 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 18:38:22 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 18:38:22 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 18:38:22 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 18:38:22 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 18:39:00 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (comparativo)
2025-11-05 18:39:00 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 18:39:00 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 18:39:00 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 18:39:00 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 18:39:00 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 18:56:33 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 18:56:33 | INFO     | __main__:consultar_cnpj:87 - Consultando CNPJ 27865757000102...
2025-11-05 18:56:54 | ERROR    | __main__:consultar_cnpj:128 - Erro na requisição SERPRO: HTTPSConnectionPool(host='api.serpro.gov.br', port=443): Max retries exceeded with url: /consulta-cnpj/v1/27865757000102 (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed out. (connect timeout=20)'))
Traceback (most recent call last):

  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           │          └ <function create_connection at 0x000001F0024659E0>
           └ <module 'urllib3.util.connection' from 'C:\\Users\\walte\\AppData\\Roaming\\Python\\Python313\\site-packages\\urllib3\\util\\...
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\util\connection.py", line 85, in create_connection
    raise err
          └ None
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\util\connection.py", line 73, in create_connection
    sock.connect(sa)
    │    │       └ ('200.198.225.75', 443)
    │    └ <method 'connect' of '_socket.socket' objects>
    └ <socket.socket [closed] fd=-1, family=2, type=1, proto=0>

TimeoutError: timed out


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connectionpool.py", line 787, in urlopen
    response = self._make_request(
               │    └ <function HTTPConnectionPool._make_request at 0x000001F0026A4900>
               └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x000001F0033A17F0>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connectionpool.py", line 488, in _make_request
    raise new_e
          └ ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed...
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
    │    │              └ <urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>
    │    └ <function HTTPSConnectionPool._validate_conn at 0x000001F0026A4EA0>
    └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x000001F0033A17F0>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connectionpool.py", line 1093, in _validate_conn
    conn.connect()
    │    └ <function HTTPSConnection.connect at 0x000001F0026A0860>
    └ <urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
    │    │             │    └ <function HTTPConnection._new_conn at 0x000001F00269BE20>
    │    │             └ <urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>
    │    └ None
    └ <urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
          └ <class 'urllib3.exceptions.ConnectTimeoutError'>

urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed out. (connect timeout=20)')


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\requests\adapters.py", line 644, in send
    resp = conn.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x000001F0026A4AE0>
           └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x000001F0033A17F0>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x000001F0024928E0>
              └ Retry(total=0, connect=None, read=False, redirect=None, status=None)
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed...
          │             │      │    └ ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed...
          │             │      └ '/consulta-cnpj/v1/27865757000102'
          │             └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x000001F0033A17F0>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='api.serpro.gov.br', port=443): Max retries exceeded with url: /consulta-cnpj/v1/27865757000102 (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed out. (connect timeout=20)'))


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\consulta_serpro.py", line 146, in <module>
    resultado = consultar_cnpj(manifest_teste)
                │              └ {'job_id': 'job_teste', 'perfil_validacao': 'PJ', 'fornecedor_id': '27865757000102'}
                └ <function consultar_cnpj at 0x000001F0033AE520>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\consulta_serpro.py", line 106, in consultar_cnpj
    response = requests.get(url, headers=headers, timeout=20)
               │        │   │            └ {'Authorization': 'Bearer ', 'Accept': 'application/json'}
               │        │   └ 'https://api.serpro.gov.br/consulta-cnpj/v1/27865757000102'
               │        └ <function get at 0x000001F0028865C0>
               └ <module 'requests' from 'C:\\Users\\walte\\AppData\\Roaming\\Python\\Python313\\site-packages\\requests\\__init__.py'>

  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
           │              │           │         └ {'headers': {'Authorization': 'Bearer ', 'Accept': 'application/json'}, 'timeout': 20}
           │              │           └ None
           │              └ 'https://api.serpro.gov.br/consulta-cnpj/v1/27865757000102'
           └ <function request at 0x000001F002886340>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           │       │              │           │      └ {'params': None, 'headers': {'Authorization': 'Bearer ', 'Accept': 'application/json'}, 'timeout': 20}
           │       │              │           └ 'https://api.serpro.gov.br/consulta-cnpj/v1/27865757000102'
           │       │              └ 'get'
           │       └ <function Session.request at 0x000001F0028C2980>
           └ <requests.sessions.Session object at 0x000001F0033A0C20>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           │    │    │       └ {'timeout': 20, 'allow_redirects': True, 'proxies': OrderedDict(), 'stream': False, 'verify': True, 'cert': None}
           │    │    └ <PreparedRequest [GET]>
           │    └ <function Session.send at 0x000001F0028C2E80>
           └ <requests.sessions.Session object at 0x000001F0033A0C20>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        │       │    │          └ {'timeout': 20, 'proxies': OrderedDict(), 'stream': False, 'verify': True, 'cert': None}
        │       │    └ <PreparedRequest [GET]>
        │       └ <function HTTPAdapter.send at 0x000001F0028C2200>
        └ <requests.adapters.HTTPAdapter object at 0x000001F0033A12B0>
  File "C:\Users\walte\AppData\Roaming\Python\Python313\site-packages\requests\adapters.py", line 665, in send
    raise ConnectTimeout(e, request=request)
          │                         └ <PreparedRequest [GET]>
          └ <class 'requests.exceptions.ConnectTimeout'>

requests.exceptions.ConnectTimeout: HTTPSConnectionPool(host='api.serpro.gov.br', port=443): Max retries exceeded with url: /consulta-cnpj/v1/27865757000102 (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x000001F0033A1BE0>, 'Connection to api.serpro.gov.br timed out. (connect timeout=20)'))
2025-11-05 19:11:41 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 19:11:41 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_003
2025-11-05 19:11:41 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_003 movido para /processing
2025-11-05 19:11:41 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 19:11:41 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_003' → 'manifest.normalizado.json'
2025-11-05 19:11:41 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_003
2025-11-05 19:11:41 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 19:11:41 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 19:11:48 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 19:11:48 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-05 19:15:12 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-11-05 19:15:12 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-11-05 19:15:54 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-11-05 19:15:54 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 19:15:54 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 19:15:54 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 19:16:25 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_003 (padrao)
2025-11-05 19:16:25 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 19:16:25 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 19:16:25 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 19:16:25 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 19:16:25 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 19:16:25 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 19:16:52 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_003 (comparativo)
2025-11-05 19:16:52 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 19:16:52 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 19:16:52 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_003\resultado
2025-11-05 19:16:52 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 19:16:52 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_003 movido para /done/
2025-11-05 19:32:24 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 19:33:37 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 19:33:37 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 19:33:37 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 19:33:37 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 19:33:37 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 19:33:37 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 19:33:37 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 19:33:37 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 19:34:05 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 19:34:05 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 19:34:05 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 19:34:05 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 19:34:25 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-05 19:34:25 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 19:34:25 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 19:34:25 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 19:34:25 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 19:34:25 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 19:34:25 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 19:34:52 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (comparativo)
2025-11-05 19:34:52 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 19:34:52 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 19:34:52 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 19:34:52 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 19:34:52 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 19:38:46 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 19:44:26 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 19:48:07 | INFO     | watcher:detect_and_move_jobs:153 - 1 job(s) detectado(s) no inbox.
2025-11-05 19:48:07 | INFO     | watcher:process_job:89 - Novo job detectado: job_bmf_turismo_001
2025-11-05 19:48:07 | INFO     | watcher:process_job:94 - Job job_bmf_turismo_001 movido para /processing
2025-11-05 19:48:07 | INFO     | manifest_loader:_load_external_schema_if_exists:93 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-05 19:48:07 | INFO     | manifest_loader:load_manifest:259 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-05 19:48:07 | INFO     | watcher:process_job:98 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-05 19:48:07 | INFO     | watcher:process_job:101 - Iniciando OCR/Docling...
2025-11-05 19:48:07 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-05 19:48:34 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-05 19:48:34 | INFO     | watcher:process_job:103 - OCR concluído com sucesso.
2025-11-05 19:48:34 | INFO     | watcher:process_job:106 - Executando IA Validador 1 (análise documental)...
2025-11-05 19:48:34 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 19:49:18 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-05 19:49:18 | INFO     | watcher:process_job:108 - Validação IA1 concluída.
2025-11-05 19:49:18 | INFO     | watcher:process_job:111 - Consultando API SERPRO...
2025-11-05 19:49:18 | ERROR    | consulta_serpro:consultar_cnpj:44 - CNPJ não informado no manifest.json
2025-11-05 19:49:18 | INFO     | watcher:process_job:113 - Consulta SERPRO concluída.
2025-11-05 19:49:18 | INFO     | watcher:process_job:116 - Executando IA Validador 2 (comparativa)...
2025-11-05 19:49:18 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-05 19:49:49 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (comparativo)
2025-11-05 19:49:49 | INFO     | watcher:process_job:123 - Validação IA2 concluída.
2025-11-05 19:49:49 | INFO     | watcher:process_job:126 - Gerando relatório final...
2025-11-05 19:49:49 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-05 19:49:49 | INFO     | watcher:process_job:128 - Relatório final gerado com sucesso.
2025-11-05 19:49:49 | INFO     | watcher:_move_to_done:70 - Job job_bmf_turismo_001 movido para /done/
2025-11-05 20:00:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:00:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:00:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:00:07 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-05 20:00:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:00:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:00:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:00:07 | INFO     | __main__:main:116 - Estrutura de diretórios verificada:
2025-11-05 20:00:07 | INFO     | __main__:main:121 - Modo DEBUG ativado
2025-11-05 20:00:07 | ERROR    | __main__:executar_pipeline_manual:75 - Manifesto não encontrado para o job job_bmf_turismo_003
2025-11-05 20:12:54 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:12:54 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:12:54 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:12:54 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-05 20:12:54 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:12:54 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:12:54 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:12:54 | INFO     | __main__:main:116 - Estrutura de diretórios verificada:
2025-11-05 20:12:54 | INFO     | __main__:main:121 - Modo DEBUG ativado
2025-11-05 20:12:54 | ERROR    | __main__:executar_pipeline_manual:75 - Manifesto não encontrado para o job job_bmf_turismo_003
2025-11-05 20:14:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:14:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:14:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:14:07 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-05 20:14:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:14:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:14:07 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:14:07 | INFO     | __main__:main:116 - Estrutura de diretórios verificada:
2025-11-05 20:14:07 | INFO     | __main__:main:121 - Modo DEBUG ativado
2025-11-05 20:14:07 | ERROR    | __main__:executar_pipeline_manual:75 - Manifesto não encontrado para o job job_bmf_turismo_003
2025-11-05 20:15:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:15:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:15:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:15:15 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-05 20:15:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:15:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:15:15 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-05 20:15:15 | INFO     | __main__:main:116 - Estrutura de diretórios verificada:
2025-11-05 20:15:15 | INFO     | __main__:main:121 - Modo DEBUG ativado
2025-11-05 20:15:15 | ERROR    | __main__:executar_pipeline_manual:75 - Manifesto não encontrado para o job job_bmf_turismo_003
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | INFO     | __main__:main:120 - Estrutura de diretórios verificada:
2025-11-06 06:47:23 | INFO     | __main__:main:125 - Modo DEBUG ativado
2025-11-06 06:47:23 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:47:23 | ERROR    | __main__:executar_pipeline_manual:79 - Manifesto não encontrado para o job job_bmf_turismo_001
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | INFO     | __main__:main:120 - Estrutura de diretórios verificada:
2025-11-06 06:48:38 | INFO     | __main__:main:125 - Modo DEBUG ativado
2025-11-06 06:48:38 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:48:38 | ERROR    | __main__:executar_pipeline_manual:79 - Manifesto não encontrado para o job job_bmf_turismo_001
2025-11-06 06:53:30 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:53:30 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:53:30 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:53:30 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 06:53:30 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:53:30 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:53:30 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:53:30 | INFO     | __main__:main:128 - Estrutura de diretórios verificada:
2025-11-06 06:53:30 | INFO     | __main__:main:133 - Modo DEBUG ativado
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | INFO     | __main__:main:131 - Estrutura de diretórios verificada:
2025-11-06 06:58:44 | INFO     | __main__:main:136 - Modo DEBUG ativado
2025-11-06 06:58:44 | WARNING  | __main__:executar_pipeline_manual:74 - [DEBUG] Conteúdo da pasta processing (processing):
2025-11-06 06:58:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 06:58:44 | WARNING  | __main__:executar_pipeline_manual:85 - [DEBUG] Verificando caminho do manifest: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\processing\job_bmf_turismo_003\manifest.json
2025-11-06 06:58:44 | WARNING  | __main__:executar_pipeline_manual:86 - [DEBUG] Existe? False
2025-11-06 06:58:44 | ERROR    | __main__:executar_pipeline_manual:90 - Manifesto não encontrado para o job job_bmf_turismo_003
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | INFO     | __main__:main:131 - Estrutura de diretórios verificada:
2025-11-06 07:01:20 | INFO     | __main__:main:136 - Modo DEBUG ativado
2025-11-06 07:01:20 | WARNING  | __main__:executar_pipeline_manual:74 - [DEBUG] Conteúdo da pasta processing (processing):
2025-11-06 07:01:20 | WARNING  | __main__:executar_pipeline_manual:76 -  - processing\job_bmf_turismo_003
2025-11-06 07:01:20 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:01:20 | WARNING  | __main__:executar_pipeline_manual:85 - [DEBUG] Verificando caminho do manifest: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\processing\job_bmf_turismo_003\manifest.json
2025-11-06 07:01:20 | WARNING  | __main__:executar_pipeline_manual:86 - [DEBUG] Existe? True
2025-11-06 07:01:20 | INFO     | __main__:executar_pipeline_manual:96 - Executando pipeline manual para depuração...
2025-11-06 07:01:20 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 07:01:33 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 07:01:33 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-06 07:08:45 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:08:45 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:08:45 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:08:45 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 07:08:45 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:08:45 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:08:45 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:08:45 | INFO     | __main__:main:131 - Estrutura de diretórios verificada:
2025-11-06 07:08:45 | INFO     | __main__:main:142 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-06 07:08:45 | INFO     | watcher:detect_and_move_jobs:186 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-06 07:08:45 | INFO     | watcher:detect_and_move_jobs:191 - 2 job(s) detectado(s) no inbox.
2025-11-06 07:08:45 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_003
2025-11-06 07:08:45 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_003 movido para /processing
2025-11-06 07:08:45 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_003: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002819C832340>
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000002819C8320C0>
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 10644)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 10644)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002819F9E67F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002819FA6DBC0>
    └ ScriptRunner(_session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000281A057DD00>
        └ <function exec_func_with_error_handling at 0x000002819FA1CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000281A057DD00>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002819F2025B0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x00000281A162A3E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000281D216E700>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/05/job_bmf_turismo_003')
    └ <function process_job at 0x00000281D216E660>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 110, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_003')
               └ <function load_manifest at 0x00000281A27E0EA0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 223, in load_manifest
    LOGGER.info(f"[MANIFEST] Carregado de: {manifest_path} (exists={os.path.exists(manifest_path)})")
                                                                    │  │    └ <built-in function _path_exists>
                                                                    │  └ <module 'ntpath' (frozen)>
                                                                    └ <module 'os' (frozen)>

NameError: name 'LOGGER' is not defined
2025-11-06 07:08:45 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_003 movido para /error/
2025-11-06 07:08:45 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:08:45 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:08:45 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002819C832340>
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000002819C8320C0>
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 10644)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 10644)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002819F9E67F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002819FA6DBC0>
    └ ScriptRunner(_session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000281A057DD00>
        └ <function exec_func_with_error_handling at 0x000002819FA1CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000281A057DD00>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002819F2025B0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x00000281A162A3E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000281D216E700>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x00000281D216E660>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 110, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_001')
               └ <function load_manifest at 0x00000281A27E0EA0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 223, in load_manifest
    LOGGER.info(f"[MANIFEST] Carregado de: {manifest_path} (exists={os.path.exists(manifest_path)})")
                                                                    │  │    └ <built-in function _path_exists>
                                                                    │  └ <module 'ntpath' (frozen)>
                                                                    └ <module 'os' (frozen)>

NameError: name 'LOGGER' is not defined
2025-11-06 07:08:45 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 07:11:15 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 07:11:15 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:11:15 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:11:15 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002819C832340>
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000002819C8320C0>
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 10644)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 10644)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 10644)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002819F9E67F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000002819FA6DBC0>
    └ ScriptRunner(_session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='31e171f4-4e7d-46b4-b8f9-ef43a42d0529', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000281A057DD00>
        └ <function exec_func_with_error_handling at 0x000002819FA1CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000281A057DD00>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000002819F2025B0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x00000281A162A3E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000281D216E700>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x00000281D216E660>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 110, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_001')
               └ <function load_manifest at 0x00000281A27E0EA0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 223, in load_manifest
    LOGGER.info(f"[MANIFEST] Carregado de: {manifest_path} (exists={os.path.exists(manifest_path)})")
                                                                    │  │    └ <built-in function _path_exists>
                                                                    │  └ <module 'ntpath' (frozen)>
                                                                    └ <module 'os' (frozen)>

NameError: name 'LOGGER' is not defined
2025-11-06 07:11:15 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 07:13:34 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:13:34 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:13:34 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:13:34 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 07:13:34 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:13:34 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:13:34 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:13:34 | INFO     | __main__:main:131 - Estrutura de diretórios verificada:
2025-11-06 07:13:34 | INFO     | __main__:main:142 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-06 07:13:34 | INFO     | watcher:detect_and_move_jobs:186 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-06 07:14:39 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 07:14:39 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:14:39 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:14:39 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: cannot access local variable 'manifest_path' where it is not associated with a value
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000020EAC3F2340>
    └ <Thread(ScriptRunner.scriptThread, started 11448)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000020EAC3F20C0>
    └ <Thread(ScriptRunner.scriptThread, started 11448)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 11448)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 11448)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='0d149788-4ba8-405e-8577-d5ffa9235022', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 11448)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000020EAF5C6930>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000020EAF649BC0>
    └ ScriptRunner(_session_id='0d149788-4ba8-405e-8577-d5ffa9235022', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='0d149788-4ba8-405e-8577-d5ffa9235022', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000020EB22ECFE0>
        └ <function exec_func_with_error_handling at 0x0000020EAF5FCB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000020EB22ECFE0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000020EB0713410, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x0000020EB22ED620>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000020EE1EB2480>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x0000020EE1EB23E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 110, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_001')
               └ <function load_manifest at 0x0000020EB25E4F40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 227, in load_manifest
    LOGGER.debug({"dbg": "manifest_keys_loaded", "keys": list(data.keys())})
    │      └ <function Logger.debug at 0x0000020EB11959E0>
    └ <loguru.logger handlers=[(id=1, level=20, sink='logs\app.log'), (id=2, level=10, sink='logs\debug.log')]>

UnboundLocalError: cannot access local variable 'manifest_path' where it is not associated with a value
2025-11-06 07:14:39 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 07:17:04 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 07:17:04 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:17:04 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:17:04 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: cannot access local variable 'manifest_path' where it is not associated with a value
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000020EAC3F2340>
    └ <Thread(ScriptRunner.scriptThread, started 11448)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000020EAC3F20C0>
    └ <Thread(ScriptRunner.scriptThread, started 11448)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 11448)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 11448)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='0d149788-4ba8-405e-8577-d5ffa9235022', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 11448)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000020EAF5C6930>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000020EAF649BC0>
    └ ScriptRunner(_session_id='0d149788-4ba8-405e-8577-d5ffa9235022', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='0d149788-4ba8-405e-8577-d5ffa9235022', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000020EB22ECFE0>
        └ <function exec_func_with_error_handling at 0x0000020EAF5FCB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000020EB22ECFE0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000020EB0713410, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x0000020EB22ED620>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000020EE1EB2480>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x0000020EE1EB23E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 110, in process_job
    manifest = load_manifest(job_dir_processing)
               │             └ WindowsPath('processing/job_bmf_turismo_001')
               └ <function load_manifest at 0x0000020EB25E4F40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 227, in load_manifest
    LOGGER.debug({"dbg": "manifest_keys_loaded", "keys": list(data.keys())})
    │      └ <function Logger.debug at 0x0000020EB11959E0>
    └ <loguru.logger handlers=[(id=1, level=20, sink='logs\app.log'), (id=2, level=10, sink='logs\debug.log')]>

UnboundLocalError: cannot access local variable 'manifest_path' where it is not associated with a value
2025-11-06 07:17:04 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | __main__:main:131 - Estrutura de diretórios verificada:
2025-11-06 07:23:19 | INFO     | __main__:main:142 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-06 07:23:19 | INFO     | watcher:detect_and_move_jobs:186 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-06 07:23:19 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 07:23:19 | INFO     | __main__:main:131 - Estrutura de diretórios verificada:
2025-11-06 07:23:19 | INFO     | __main__:main:142 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-06 07:23:19 | INFO     | watcher:detect_and_move_jobs:186 - Watcher iniciado. Monitorando /inbox por novos jobs...
2025-11-06 07:24:54 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 07:24:54 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:24:54 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:24:54 | INFO     | manifest_loader:load_manifest:233 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_001\manifest.json (exists=True)
2025-11-06 07:24:54 | INFO     | manifest_loader:_load_external_schema_if_exists:97 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-06 07:24:54 | INFO     | manifest_loader:load_manifest:271 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-06 07:24:54 | INFO     | watcher:process_job:111 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-06 07:24:54 | INFO     | watcher:process_job:114 - Iniciando OCR/Docling...
2025-11-06 07:24:54 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 07:25:00 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 07:25:00 | INFO     | watcher:process_job:116 - OCR concluído com sucesso.
2025-11-06 07:25:00 | INFO     | watcher:process_job:119 - Executando IA Validador 1 (análise documental)...
2025-11-06 07:25:00 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 07:25:46 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-06 07:25:46 | INFO     | watcher:process_job:121 - Validação IA1 concluída.
2025-11-06 07:25:46 | INFO     | watcher:process_job:124 - Consultando dados ReceitaWS...
2025-11-06 07:25:46 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'manifest_data' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CE26FA2340>
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001CE26FA20C0>
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21608)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21608)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001CE2A0127F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001CE2A099BC0>
    └ ScriptRunner(_session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE441F6480>
        └ <function exec_func_with_error_handling at 0x000001CE2A050B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE441F6480>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001CE29A14010, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x000001CE5C7EEC00>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001CE5C7EE980>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x000001CE5C7EE8E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 126, in process_job
    _stage_manifest_for_serpro(job_id, manifest_data, DIRS)
    │                          │                      └ {'BASE_DIR': 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2', 'INBOX_DIR': 'i...
    │                          └ 'job_bmf_turismo_001'
    └ <function _stage_manifest_for_serpro at 0x000001CE2CC596C0>

NameError: name 'manifest_data' is not defined
2025-11-06 07:25:46 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 07:38:14 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 07:38:14 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:38:14 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:38:14 | INFO     | manifest_loader:load_manifest:233 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_001\manifest.json (exists=True)
2025-11-06 07:38:14 | INFO     | manifest_loader:_load_external_schema_if_exists:97 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-06 07:38:14 | INFO     | manifest_loader:load_manifest:271 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-06 07:38:14 | INFO     | watcher:process_job:111 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-06 07:38:14 | INFO     | watcher:process_job:114 - Iniciando OCR/Docling...
2025-11-06 07:38:14 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 07:38:19 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 07:38:19 | INFO     | watcher:process_job:116 - OCR concluído com sucesso.
2025-11-06 07:38:19 | INFO     | watcher:process_job:119 - Executando IA Validador 1 (análise documental)...
2025-11-06 07:38:19 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 07:38:37 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-06 07:38:37 | INFO     | watcher:process_job:121 - Validação IA1 concluída.
2025-11-06 07:38:37 | INFO     | watcher:process_job:124 - Consultando dados ReceitaWS...
2025-11-06 07:38:37 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'manifest_data' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CE26FA2340>
    └ <Thread(ScriptRunner.scriptThread, started 23520)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001CE26FA20C0>
    └ <Thread(ScriptRunner.scriptThread, started 23520)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 23520)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 23520)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='51107e73-9176-4ac8-8e53-23f65ce74a6c', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 23520)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001CE2A0127F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x000001CE2A099BC0>
    └ ScriptRunner(_session_id='51107e73-9176-4ac8-8e53-23f65ce74a6c', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='51107e73-9176-4ac8-8e53-23f65ce74a6c', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE2AC01580>
        └ <function exec_func_with_error_handling at 0x000001CE2A050B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE2AC01580>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001CE29A14010, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x000001CE5C7EEA20>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001CE5C7EE980>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x000001CE5C7EE8E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 126, in process_job
    _stage_manifest_for_serpro(job_id, manifest_data, DIRS)
    │                          │                      └ {'BASE_DIR': 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2', 'INBOX_DIR': 'i...
    │                          └ 'job_bmf_turismo_001'
    └ <function _stage_manifest_for_serpro at 0x000001CE2CC596C0>

NameError: name 'manifest_data' is not defined
2025-11-06 07:38:37 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 07:44:32 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 07:44:32 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 07:44:32 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 07:44:32 | INFO     | manifest_loader:load_manifest:233 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_001\manifest.json (exists=True)
2025-11-06 07:44:32 | INFO     | manifest_loader:_load_external_schema_if_exists:97 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-06 07:44:32 | INFO     | manifest_loader:load_manifest:271 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-06 07:44:32 | INFO     | watcher:process_job:111 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-06 07:44:32 | INFO     | watcher:process_job:114 - Iniciando OCR/Docling...
2025-11-06 07:44:32 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 07:44:59 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 07:44:59 | INFO     | watcher:process_job:116 - OCR concluído com sucesso.
2025-11-06 07:44:59 | INFO     | watcher:process_job:119 - Executando IA Validador 1 (análise documental)...
2025-11-06 07:44:59 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 07:45:20 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-06 07:45:20 | INFO     | watcher:process_job:121 - Validação IA1 concluída.
2025-11-06 07:45:20 | INFO     | watcher:process_job:124 - Consultando dados ReceitaWS...
2025-11-06 07:45:20 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'manifest_data' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CE26FA2340>
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001CE26FA20C0>
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21608)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21608)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001CE2A0127F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001CE2A099BC0>
    └ ScriptRunner(_session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE441F6480>
        └ <function exec_func_with_error_handling at 0x000001CE2A050B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE441F6480>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001CE29A14010, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x000001CE5C7EEC00>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001CE5C7EE980>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x000001CE5C7EE8E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 126, in process_job
    _stage_manifest_for_serpro(job_id, manifest_data, DIRS)
    │                          │                      └ {'BASE_DIR': 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2', 'INBOX_DIR': 'i...
    │                          └ 'job_bmf_turismo_001'
    └ <function _stage_manifest_for_serpro at 0x000001CE2CC596C0>

NameError: name 'manifest_data' is not defined
2025-11-06 07:45:20 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 08:28:02 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 08:28:02 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 08:28:02 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 08:28:02 | INFO     | manifest_loader:load_manifest:233 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_001\manifest.json (exists=True)
2025-11-06 08:28:02 | INFO     | manifest_loader:_load_external_schema_if_exists:97 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-06 08:28:02 | INFO     | manifest_loader:load_manifest:271 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-06 08:28:02 | INFO     | watcher:process_job:111 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-06 08:28:02 | INFO     | watcher:process_job:114 - Iniciando OCR/Docling...
2025-11-06 08:28:02 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 08:28:29 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 08:28:29 | INFO     | watcher:process_job:116 - OCR concluído com sucesso.
2025-11-06 08:28:29 | INFO     | watcher:process_job:119 - Executando IA Validador 1 (análise documental)...
2025-11-06 08:28:29 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 08:29:14 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-06 08:29:14 | INFO     | watcher:process_job:121 - Validação IA1 concluída.
2025-11-06 08:29:14 | INFO     | watcher:process_job:124 - Consultando dados ReceitaWS...
2025-11-06 08:29:14 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'manifest_data' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CE26FA2340>
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001CE26FA20C0>
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21608)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21608)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21608)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001CE2A0127F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001CE2A099BC0>
    └ ScriptRunner(_session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='164d0032-0bc7-42ea-a6c4-422f86a91505', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE441F6480>
        └ <function exec_func_with_error_handling at 0x000001CE2A050B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE441F6480>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001CE29A14010, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x000001CE5C7EEC00>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001CE5C7EE980>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x000001CE5C7EE8E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 126, in process_job
    _stage_manifest_for_serpro(job_id, manifest_data, DIRS)
    │                          │                      └ {'BASE_DIR': 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2', 'INBOX_DIR': 'i...
    │                          └ 'job_bmf_turismo_001'
    └ <function _stage_manifest_for_serpro at 0x000001CE2CC596C0>

NameError: name 'manifest_data' is not defined
2025-11-06 08:29:14 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 08:42:04 | INFO     | watcher:detect_and_move_jobs:191 - 1 job(s) detectado(s) no inbox.
2025-11-06 08:42:04 | INFO     | watcher:process_job:102 - Novo job detectado: job_bmf_turismo_001
2025-11-06 08:42:04 | INFO     | watcher:process_job:107 - Job job_bmf_turismo_001 movido para /processing
2025-11-06 08:42:04 | INFO     | manifest_loader:load_manifest:233 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_001\manifest.json (exists=True)
2025-11-06 08:42:04 | INFO     | manifest_loader:_load_external_schema_if_exists:97 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-06 08:42:04 | INFO     | manifest_loader:load_manifest:271 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-06 08:42:04 | INFO     | watcher:process_job:111 - Manifest carregado com sucesso para job job_bmf_turismo_001
2025-11-06 08:42:04 | INFO     | watcher:process_job:114 - Iniciando OCR/Docling...
2025-11-06 08:42:04 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 08:42:29 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 08:42:29 | INFO     | watcher:process_job:116 - OCR concluído com sucesso.
2025-11-06 08:42:29 | INFO     | watcher:process_job:119 - Executando IA Validador 1 (análise documental)...
2025-11-06 08:42:29 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 08:43:03 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-06 08:43:03 | INFO     | watcher:process_job:121 - Validação IA1 concluída.
2025-11-06 08:43:03 | INFO     | watcher:process_job:124 - Consultando dados ReceitaWS...
2025-11-06 08:43:03 | ERROR    | watcher:process_job:171 - Erro ao processar job job_bmf_turismo_001: name 'manifest_data' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CE26FA2340>
    └ <Thread(ScriptRunner.scriptThread, started 23520)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001CE26FA20C0>
    └ <Thread(ScriptRunner.scriptThread, started 23520)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 23520)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 23520)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='51107e73-9176-4ac8-8e53-23f65ce74a6c', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 23520)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001CE2A0127F0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x000001CE2A099BC0>
    └ ScriptRunner(_session_id='51107e73-9176-4ac8-8e53-23f65ce74a6c', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='51107e73-9176-4ac8-8e53-23f65ce74a6c', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE2AC01580>
        └ <function exec_func_with_error_handling at 0x000001CE2A050B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE2AC01580>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001CE29A14010, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 146, in <module>
    main()
    └ <function main at 0x000001CE5C7EEA20>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 143, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001CE5C7EE980>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 193, in detect_and_move_jobs
    process_job(job)
    │           └ WindowsPath('inbox/2025/11/06/job_bmf_turismo_001')
    └ <function process_job at 0x000001CE5C7EE8E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 126, in process_job
    _stage_manifest_for_serpro(job_id, manifest_data, DIRS)
    │                          │                      └ {'BASE_DIR': 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2', 'INBOX_DIR': 'i...
    │                          └ 'job_bmf_turismo_001'
    └ <function _stage_manifest_for_serpro at 0x000001CE2CC596C0>

NameError: name 'manifest_data' is not defined
2025-11-06 08:43:03 | ERROR    | watcher:_move_to_error:92 - Job job_bmf_turismo_001 movido para /error/
2025-11-06 08:52:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 08:52:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 08:52:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 08:52:44 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-06 08:52:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 08:52:44 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-06 08:52:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 08:52:44 | INFO     | log_service:init_folders:101 - Estrutura de diretórios inicializada com sucesso.
2025-11-06 08:52:44 | INFO     | __main__:main:140 - Estrutura de diretórios verificada:
2025-11-06 08:52:44 | INFO     | __main__:main:151 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-06 08:52:44 | INFO     | watcher:detect_and_move_jobs:170 - Iniciando monitoramento do diretório /inbox …
2025-11-06 08:52:44 | INFO     | watcher:detect_and_move_jobs:174 - 1 job(s) detectado(s) em /inbox.
2025-11-06 08:52:44 | INFO     | log_service:registrar_evento:123 - [job_bmf_turismo_001] [WATCHER] Novo job detectado em inbox: inbox/2025/11/06/job_bmf_turismo_001
2025-11-06 08:52:44 | INFO     | log_service:registrar_evento:123 - [job_bmf_turismo_001] [WATCHER] Job movido para processing: processing/job_bmf_turismo_001
2025-11-06 08:52:44 | INFO     | manifest_loader:load_manifest:233 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_001\manifest.json (exists=True)
2025-11-06 08:52:44 | INFO     | manifest_loader:_load_external_schema_if_exists:97 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-06 08:52:44 | INFO     | manifest_loader:load_manifest:271 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_001' → 'manifest.normalizado.json'
2025-11-06 08:52:44 | INFO     | watcher:process_job:124 - [job_bmf_turismo_001] Iniciando OCR/Docling…
2025-11-06 08:52:44 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-06 08:52:57 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-06 08:52:57 | INFO     | watcher:process_job:126 - [job_bmf_turismo_001] OCR/Docling concluído: OK
2025-11-06 08:52:57 | INFO     | watcher:process_job:129 - [job_bmf_turismo_001] Iniciando IA Validador 1…
2025-11-06 08:52:57 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 08:53:20 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (padrao)
2025-11-06 08:53:20 | INFO     | watcher:process_job:131 - [job_bmf_turismo_001] IA1 concluída: OK
2025-11-06 08:53:20 | INFO     | watcher:process_job:134 - [job_bmf_turismo_001] Consultando dados ReceitaWS…
2025-11-06 08:53:20 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_001] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_001/serpro/manifest_for_serpro.json
2025-11-06 08:53:21 | INFO     | consulta_serpro:_mark_manifest_done:67 - [RECEITAWS] Manifesto marcado como done: outbox\job_bmf_turismo_001\serpro\manifest_for_serpro.done.json
2025-11-06 08:53:21 | INFO     | watcher:process_job:140 - [job_bmf_turismo_001] ReceitaWS concluída: OK
2025-11-06 08:53:21 | INFO     | watcher:process_job:143 - [job_bmf_turismo_001] Iniciando IA Validador 2 (comparativa)…
2025-11-06 08:53:21 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-06 08:53:51 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_001 (comparativo)
2025-11-06 08:53:51 | INFO     | watcher:process_job:150 - [job_bmf_turismo_001] IA2 concluída: OK
2025-11-06 08:53:51 | INFO     | watcher:process_job:153 - [job_bmf_turismo_001] Gerando relatório final…
2025-11-06 08:53:51 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_001\resultado
2025-11-06 08:53:51 | INFO     | watcher:process_job:155 - [job_bmf_turismo_001] Relatório final gerado.
2025-11-06 08:53:51 | INFO     | log_service:registrar_evento:123 - [job_bmf_turismo_001] [WATCHER] Pipeline concluído com sucesso
2025-11-12 16:05:37.253 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:05:37.300 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:05:37.317 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:05:37.320 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:05:37.342 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:05:37.345 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:05:37.382 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:05:37.395 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:09:15.360 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:10:07.838 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:10:56.511 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:11:08.898 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:11:12.111 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:11:29.117 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.394 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.399 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.405 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.405 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:12:10.410 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.411 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:12:10.417 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.422 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:12:10.423 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:17:48.859 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:17:48.862 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:17:48.866 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:17:48.867 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:17:48.871 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:17:48.872 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:17:48.876 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:17:48.880 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:17:48.881 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:18:46.715 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.622 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.629 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.638 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.639 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:20:20.650 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.651 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:20:20.654 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.659 | INFO     | log_service:init_folders:112 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:20:20.659 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:22:18.334 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:22:18.340 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:22:18.345 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:22:18.346 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:22:18.350 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:22:18.352 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:22:18.355 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:22:18.360 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:22:18.361 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:22:18.363 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:22:18.363 | INFO     | watcher:detect_and_move_jobs:170 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:22:18.367 | INFO     | watcher:detect_and_move_jobs:174 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:22:18.368 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:22:18.372 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:22:18.374 | ERROR    | watcher:process_job:162 - [12] Erro durante o processamento do job: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001F6B76C2340>
    └ <Thread(ScriptRunner.scriptThread, started 26592)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001F6B76C20C0>
    └ <Thread(ScriptRunner.scriptThread, started 26592)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 26592)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 26592)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='429992d4-845a-42b2-9fbf-7215d45aa43a', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 26592)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001F6BA852C00>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x000001F6BA8CDBC0>
    └ ScriptRunner(_session_id='429992d4-845a-42b2-9fbf-7215d45aa43a', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='429992d4-845a-42b2-9fbf-7215d45aa43a', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001F6BB3E1800>
        └ <function exec_func_with_error_handling at 0x000001F6BA87CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001F6BB3E1800>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001F6B9319160, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001F6BD54C4A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001F6ECFF6200>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 176, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/12')
    └ <function process_job at 0x000001F6ECFF6160>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/12')
              │         │      └ <function load_manifest at 0x000001F6BD675120>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 236, in load_manifest
    LOGGER.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                 │                       │             └ <function PathBase.exists at 0x000001F6B9CC3880>
                                                 │                       └ WindowsPath('processing/12/manifest.json')
                                                 └ WindowsPath('processing/12/manifest.json')

NameError: name 'LOGGER' is not defined
2025-11-12 16:27:06.463 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:27:06.468 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:27:06.474 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:27:06.475 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:27:06.479 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:27:06.480 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:27:06.483 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:27:06.487 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:27:06.488 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:27:06.489 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:27:06.490 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:33:07.405 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:33:07.409 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:33:07.412 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:33:07.412 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:33:07.416 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:33:07.416 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:33:07.419 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:33:07.423 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:33:07.423 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:33:07.425 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:33:07.426 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:34:12.494 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:34:12.496 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_004] WATCHER
2025-11-12 16:34:12.500 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_004] WATCHER
2025-11-12 16:34:12.502 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_004] Erro durante o processamento do job: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022F99822340>
    └ <Thread(ScriptRunner.scriptThread, started 4032)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000022F998220C0>
    └ <Thread(ScriptRunner.scriptThread, started 4032)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 4032)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 4032)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='68cb584b-f9c8-4237-bb08-a10a6d761370', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 4032)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000022F9C922D90>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x0000022F9C99DBC0>
    └ ScriptRunner(_session_id='68cb584b-f9c8-4237-bb08-a10a6d761370', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='68cb584b-f9c8-4237-bb08-a10a6d761370', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000022F9D4E59E0>
        └ <function exec_func_with_error_handling at 0x0000022F9C94CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000022F9D4E59E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000022F9C0CF250, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000022F9F6587C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000022FCF17A5C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12/job_bmf_turismo_004')
    └ <function process_job at 0x0000022FCF17A520>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/job_bmf_turismo_004')
              │         │      └ <function load_manifest at 0x0000022F9F78D440>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 236, in load_manifest
    LOGGER.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                 │                       │             └ <function PathBase.exists at 0x0000022F9BD93880>
                                                 │                       └ WindowsPath('processing/job_bmf_turismo_004/manifest.json')
                                                 └ WindowsPath('processing/job_bmf_turismo_004/manifest.json')

NameError: name 'LOGGER' is not defined
2025-11-12 16:34:12.515 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: name 'LOGGER' is not defined
2025-11-12 16:34:47.548 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:34:47.548 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_004] WATCHER
2025-11-12 16:34:47.552 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_004] WATCHER
2025-11-12 16:34:47.553 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_004] Erro durante o processamento do job: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000022F99822340>
    └ <Thread(ScriptRunner.scriptThread, started 4032)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000022F998220C0>
    └ <Thread(ScriptRunner.scriptThread, started 4032)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 4032)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 4032)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='68cb584b-f9c8-4237-bb08-a10a6d761370', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 4032)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000022F9C922D90>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x0000022F9C99DBC0>
    └ ScriptRunner(_session_id='68cb584b-f9c8-4237-bb08-a10a6d761370', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='68cb584b-f9c8-4237-bb08-a10a6d761370', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000022F9D4E59E0>
        └ <function exec_func_with_error_handling at 0x0000022F9C94CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000022F9D4E59E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000022F9C0CF250, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000022F9F6587C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000022FCF17A5C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12/job_bmf_turismo_004')
    └ <function process_job at 0x0000022FCF17A520>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/job_bmf_turismo_004')
              │         │      └ <function load_manifest at 0x0000022F9F78D440>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 236, in load_manifest
    LOGGER.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                 │                       │             └ <function PathBase.exists at 0x0000022F9BD93880>
                                                 │                       └ WindowsPath('processing/job_bmf_turismo_004/manifest.json')
                                                 └ WindowsPath('processing/job_bmf_turismo_004/manifest.json')

NameError: name 'LOGGER' is not defined
2025-11-12 16:35:48.950 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:35:48.955 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:35:48.960 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:35:48.960 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:35:48.963 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:35:48.964 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:35:48.967 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:35:48.971 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:35:48.972 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:35:48.973 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:35:48.974 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:35:53.983 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:35:53.983 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_004] WATCHER
2025-11-12 16:38:23.013 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:38:23.017 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:38:23.024 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:38:23.025 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:38:23.031 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:38:23.031 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:38:23.034 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:38:23.036 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:38:35.504 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:39:04.433 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:39:10.205 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:39:13.423 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:39:54.530 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:40:20.392 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:40:27.730 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:40:32.951 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:40:36.920 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:40:45.356 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.469 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.472 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.476 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.476 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:41:59.480 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.480 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:41:59.482 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.486 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:41:59.487 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:41:59.488 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:41:59.488 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:41:59.492 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:41:59.493 | INFO     | log_service:registrar_evento:164 - [job_004] WATCHER
2025-11-12 16:41:59.495 | INFO     | log_service:registrar_evento:164 - [job_004] WATCHER
2025-11-12 16:41:59.496 | ERROR    | watcher:process_job:162 - [job_004] Erro durante o processamento do job: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000021E23F82340>
    └ <Thread(ScriptRunner.scriptThread, started 18912)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000021E23F820C0>
    └ <Thread(ScriptRunner.scriptThread, started 18912)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 18912)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 18912)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='cb9e674c-3f21-4661-8d72-f26536c2209d', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 18912)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000021E2706ECF0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000021E270EDBC0>
    └ ScriptRunner(_session_id='cb9e674c-3f21-4661-8d72-f26536c2209d', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='cb9e674c-3f21-4661-8d72-f26536c2209d', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000021E27C01760>
        └ <function exec_func_with_error_handling at 0x0000021E270A0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000021E27C01760>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000021E269F29C0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000021E29D6C360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000021E59802160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_004')
    └ <function process_job at 0x0000021E598020C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/job_004')
              │         │      └ <function load_manifest at 0x0000021E29EA0FE0>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 236, in load_manifest
    LOGGER.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                 │                       │             └ <function PathBase.exists at 0x0000021E264E3880>
                                                 │                       └ WindowsPath('processing/job_004/manifest.json')
                                                 └ WindowsPath('processing/job_004/manifest.json')

NameError: name 'LOGGER' is not defined
2025-11-12 16:41:59.513 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: name 'LOGGER' is not defined
2025-11-12 16:42:19.533 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:42:19.534 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:42:19.539 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:42:19.540 | ERROR    | watcher:process_job:162 - [12] Erro durante o processamento do job: name 'LOGGER' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000021E23F82340>
    └ <Thread(ScriptRunner.scriptThread, started 18912)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000021E23F820C0>
    └ <Thread(ScriptRunner.scriptThread, started 18912)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 18912)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 18912)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='cb9e674c-3f21-4661-8d72-f26536c2209d', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 18912)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000021E2706ECF0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000021E270EDBC0>
    └ ScriptRunner(_session_id='cb9e674c-3f21-4661-8d72-f26536c2209d', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='cb9e674c-3f21-4661-8d72-f26536c2209d', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000021E27C01760>
        └ <function exec_func_with_error_handling at 0x0000021E270A0B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000021E27C01760>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000021E269F29C0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000021E29D6C360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000021E59802160>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12')
    └ <function process_job at 0x0000021E598020C0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/12')
              │         │      └ <function load_manifest at 0x0000021E29EA0FE0>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 236, in load_manifest
    LOGGER.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                 │                       │             └ <function PathBase.exists at 0x0000021E264E3880>
                                                 │                       └ WindowsPath('processing/12/manifest.json')
                                                 └ WindowsPath('processing/12/manifest.json')

NameError: name 'LOGGER' is not defined
2025-11-12 16:42:19.549 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: name 'LOGGER' is not defined
2025-11-12 16:51:02.956 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:51:02.963 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:51:02.967 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:51:02.967 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 16:51:02.971 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:51:02.971 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 16:51:02.974 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:51:02.979 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:51:02.979 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:51:02.981 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:51:02.981 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:52:38.097 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:52:38.097 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:52:38.100 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:52:38.101 | ERROR    | watcher:process_job:162 - [12] Erro durante o processamento do job: name '_logger' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001A77EBF2340>
    └ <Thread(ScriptRunner.scriptThread, started 17800)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001A77EBF20C0>
    └ <Thread(ScriptRunner.scriptThread, started 17800)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 17800)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 17800)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='83016aab-89fc-4d48-a824-2fa0e3cf8f78', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 17800)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001A701D4AC00>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001A701DCDBC0>
    └ ScriptRunner(_session_id='83016aab-89fc-4d48-a824-2fa0e3cf8f78', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='83016aab-89fc-4d48-a824-2fa0e3cf8f78', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A7028E1760>
        └ <function exec_func_with_error_handling at 0x000001A701D84B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A7028E1760>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001A70171D070, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001A704A4C360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001A7344F9EE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12')
    └ <function process_job at 0x000001A7344F9E40>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/12')
              │         │      └ <function load_manifest at 0x000001A704B64EA0>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 218, in load_manifest
    _logger.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                  │                       │             └ <function PathBase.exists at 0x000001A77FD43880>
                                                  │                       └ WindowsPath('processing/12/manifest.json')
                                                  └ WindowsPath('processing/12/manifest.json')

NameError: name '_logger' is not defined
2025-11-12 16:52:38.111 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: name '_logger' is not defined
2025-11-12 16:55:02.157 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:55:02.158 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:55:02.159 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:55:02.159 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:55:37.204 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:55:37.205 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:55:37.208 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:55:37.210 | ERROR    | watcher:process_job:162 - [12] Erro durante o processamento do job: name '_logger' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001A77EBF2340>
    └ <Thread(ScriptRunner.scriptThread, started 25052)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001A77EBF20C0>
    └ <Thread(ScriptRunner.scriptThread, started 25052)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 25052)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 25052)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='5400dac0-7992-4803-8baa-c3f83242d222', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 25052)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001A701D4AC00>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001A701DCDBC0>
    └ ScriptRunner(_session_id='5400dac0-7992-4803-8baa-c3f83242d222', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='5400dac0-7992-4803-8baa-c3f83242d222', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A7344FB740>
        └ <function exec_func_with_error_handling at 0x000001A701D84B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A7344FB740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001A724775D10, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001A7344FBB00>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001A7344F9EE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12')
    └ <function process_job at 0x000001A7344F9E40>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/12')
              │         │      └ <function load_manifest at 0x000001A704B64EA0>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 218, in load_manifest
    _logger.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                  │                       │             └ <function PathBase.exists at 0x000001A77FD43880>
                                                  │                       └ WindowsPath('processing/12/manifest.json')
                                                  └ WindowsPath('processing/12/manifest.json')

NameError: name '_logger' is not defined
2025-11-12 16:55:37.220 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: name '_logger' is not defined
2025-11-12 16:57:46.330 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 16:57:46.330 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 16:57:46.331 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 16:57:46.331 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 16:58:12.398 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 16:58:12.398 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:58:12.401 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 16:58:12.406 | ERROR    | watcher:process_job:162 - [12] Erro durante o processamento do job: name '_logger' is not defined
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001A77EBF2340>
    └ <Thread(ScriptRunner.scriptThread, started 25052)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001A77EBF20C0>
    └ <Thread(ScriptRunner.scriptThread, started 25052)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 25052)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 25052)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='5400dac0-7992-4803-8baa-c3f83242d222', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 25052)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001A701D4AC00>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001A701DCDBC0>
    └ ScriptRunner(_session_id='5400dac0-7992-4803-8baa-c3f83242d222', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='5400dac0-7992-4803-8baa-c3f83242d222', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A7344FB740>
        └ <function exec_func_with_error_handling at 0x000001A701D84B80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A7344FB740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001A724775D10, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001A7344FBB00>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001A7344F9EE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12')
    └ <function process_job at 0x000001A7344F9E40>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/12')
              │         │      └ <function load_manifest at 0x000001A704B64EA0>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 218, in load_manifest
    _logger.info(f"[MANIFEST] Tentando carregar: {manifest_path} (exists={manifest_path.exists()})")
                                                  │                       │             └ <function PathBase.exists at 0x000001A77FD43880>
                                                  │                       └ WindowsPath('processing/12/manifest.json')
                                                  └ WindowsPath('processing/12/manifest.json')

NameError: name '_logger' is not defined
2025-11-12 16:58:12.416 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: name '_logger' is not defined
2025-11-12 17:00:57.233 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:00:57.236 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:00:57.239 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:00:57.239 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 17:00:57.242 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:00:57.242 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 17:00:57.244 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:00:57.248 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:00:57.248 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 17:00:57.249 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 17:00:57.249 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 17:01:13.374 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:01:13.375 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 17:01:13.376 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 17:01:13.377 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 17:01:42.292 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-12 17:01:42.292 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 17:01:42.295 | INFO     | log_service:registrar_evento:164 - [12] WATCHER
2025-11-12 17:01:42.296 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\12\manifest.json (exists=True)
2025-11-12 17:01:42.300 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-12 17:01:42.303 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/12' → 'manifest.normalizado.json'
2025-11-12 17:01:42.304 | WARNING  | watcher:process_job:121 - [12] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-11-12 17:01:42.305 | INFO     | watcher:process_job:124 - [12] Iniciando OCR/Docling…
2025-11-12 17:01:42.307 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-12 17:02:28.084 | WARNING  | extrator_docling:extrair_com_docling:122 - Docling falhou: [WinError 1314] O cliente não tem o privilégio necessário: '..\\..\\blobs\\a6344aac8c09253b3b630fb776ae94478aa0275b' -> 'C:\\Users\\walte\\.cache\\huggingface\\hub\\models--docling-project--docling-layout-heron\\snapshots\\bdb7099d742220552d703932cc0ce0a26a7a8da8\\.gitattributes'
2025-11-12 17:02:38.330 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Tesseract
2025-11-12 17:02:38.332 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-12 17:03:18.644 | WARNING  | extrator_docling:extrair_com_docling:122 - Docling falhou: [WinError 1314] O cliente não tem o privilégio necessário: '..\\..\\blobs\\575b058b45230d48a06df9b1944f4bd40949db1d' -> 'C:\\Users\\walte\\.cache\\huggingface\\hub\\models--docling-project--docling-models\\snapshots\\fc0f2d45e2218ea24bce5045f58a389aed16dc23\\.gitattributes'
2025-11-12 17:03:59.402 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Tesseract
2025-11-12 17:03:59.404 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-11-12 17:04:35.833 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-11-12 17:04:35.835 | INFO     | watcher:process_job:126 - [12] OCR/Docling concluído: OK
2025-11-12 17:04:35.836 | INFO     | watcher:process_job:129 - [12] Iniciando IA Validador 1…
2025-11-12 17:04:35.841 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-12 17:05:12.244 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para 12 (padrao)
2025-11-12 17:05:12.246 | INFO     | watcher:process_job:131 - [12] IA1 concluída: OK
2025-11-12 17:05:12.246 | INFO     | watcher:process_job:134 - [12] Consultando dados ReceitaWS…
2025-11-12 17:05:12.248 | INFO     | watcher:_stage_manifest_for_serpro:92 - [12] Manifest staged para ReceitaWS: outbox/12/serpro/manifest_for_serpro.json
2025-11-12 17:05:13.292 | INFO     | watcher:process_job:140 - [12] ReceitaWS concluída: OK
2025-11-12 17:05:13.292 | INFO     | watcher:process_job:143 - [12] Iniciando IA Validador 2 (comparativa)…
2025-11-12 17:05:13.295 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-12 17:05:42.261 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para 12 (comparativo)
2025-11-12 17:05:42.263 | INFO     | watcher:process_job:150 - [12] IA2 concluída: OK
2025-11-12 17:05:42.265 | INFO     | watcher:process_job:153 - [12] Gerando relatório final…
2025-11-12 17:05:42.274 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\12\resultado
2025-11-12 17:05:42.274 | INFO     | watcher:process_job:155 - [12] Relatório final gerado.
2025-11-12 17:05:42.277 | ERROR    | watcher:process_job:162 - [12] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001CE1D3F2340>
    └ <Thread(ScriptRunner.scriptThread, started 18572)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001CE1D3F20C0>
    └ <Thread(ScriptRunner.scriptThread, started 18572)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 18572)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 18572)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='912cff0c-feba-4505-a85b-5c06bd75ea09', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 18572)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001CE20532ED0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x000001CE205ADBC0>
    └ ScriptRunner(_session_id='912cff0c-feba-4505-a85b-5c06bd75ea09', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='912cff0c-feba-4505-a85b-5c06bd75ea09', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE210C1760>
        └ <function exec_func_with_error_handling at 0x000001CE2055CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001CE210C1760>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001CE1FDFB0D0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001CE231DC360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001CE52CADEE0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11/12')
    └ <function process_job at 0x000001CE52CADE40>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ '12'
    └ <function registrar_evento at 0x000001CE2212E160>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-11-12 17:05:42.284 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-11-12 17:14:58.923 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.927 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.931 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.932 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 17:14:58.935 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.936 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 17:14:58.939 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.945 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.945 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 17:14:58.946 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:14:58.946 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 17:14:58.948 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 17:14:58.948 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 17:14:58.950 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 17:14:58.951 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 17:17:02.570 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:17:02.575 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:17:02.579 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:17:02.579 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 17:17:02.582 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:17:02.582 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 17:17:02.584 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:17:02.586 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:18:23.612 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:18:33.098 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:18:40.748 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:18:43.955 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:18:58.706 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:21:23.211 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:21:33.576 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:21:36.114 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:21:43.710 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:21:48.526 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:21:50.210 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.956 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.960 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.963 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.963 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 17:23:40.966 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.966 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 17:23:40.968 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.972 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 17:23:40.972 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 17:23:40.973 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 17:23:40.974 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-12 17:23:40.977 | INFO     | watcher:detect_and_move_jobs:175 - 2 job(s) detectado(s) em /inbox.
2025-11-12 17:23:40.977 | INFO     | log_service:registrar_evento:164 - [job_005] WATCHER
2025-11-12 17:23:40.980 | INFO     | log_service:registrar_evento:164 - [job_005] WATCHER
2025-11-12 17:23:40.981 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_005\manifest.json (exists=True)
2025-11-12 17:23:40.984 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-12 17:23:40.986 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_005' → 'manifest.normalizado.json'
2025-11-12 17:23:40.987 | WARNING  | watcher:process_job:121 - [job_005] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-11-12 17:23:40.987 | INFO     | watcher:process_job:124 - [job_005] Iniciando OCR/Docling…
2025-11-12 17:23:40.989 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-12 17:23:46.283 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-12 17:23:46.284 | INFO     | watcher:process_job:126 - [job_005] OCR/Docling concluído: OK
2025-11-12 17:23:46.285 | INFO     | watcher:process_job:129 - [job_005] Iniciando IA Validador 1…
2025-11-12 17:23:46.289 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-12 17:24:01.940 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_005 (padrao)
2025-11-12 17:24:01.941 | INFO     | watcher:process_job:131 - [job_005] IA1 concluída: OK
2025-11-12 17:24:01.942 | INFO     | watcher:process_job:134 - [job_005] Consultando dados ReceitaWS…
2025-11-12 17:24:01.946 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_005] Manifest staged para ReceitaWS: outbox/job_005/serpro/manifest_for_serpro.json
2025-11-12 17:24:03.177 | INFO     | watcher:process_job:140 - [job_005] ReceitaWS concluída: OK
2025-11-12 17:24:03.178 | INFO     | watcher:process_job:143 - [job_005] Iniciando IA Validador 2 (comparativa)…
2025-11-12 17:24:03.179 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-11-12 17:24:20.054 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_005 (comparativo)
2025-11-12 17:24:20.056 | INFO     | watcher:process_job:150 - [job_005] IA2 concluída: OK
2025-11-12 17:24:20.056 | INFO     | watcher:process_job:153 - [job_005] Gerando relatório final…
2025-11-12 17:24:20.065 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_005\resultado
2025-11-12 17:24:20.066 | INFO     | watcher:process_job:155 - [job_005] Relatório final gerado.
2025-11-12 17:24:20.068 | ERROR    | watcher:process_job:162 - [job_005] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023480D02340>
    └ <Thread(ScriptRunner.scriptThread, started 21884)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023480D020C0>
    └ <Thread(ScriptRunner.scriptThread, started 21884)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21884)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21884)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='1d8d65bc-b1ae-464d-b7a4-083be2e8f19f', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21884)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000023483DE2F20>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000023483E5DBC0>
    └ ScriptRunner(_session_id='1d8d65bc-b1ae-464d-b7a4-083be2e8f19f', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='1d8d65bc-b1ae-464d-b7a4-083be2e8f19f', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000023484975760>
        └ <function exec_func_with_error_handling at 0x0000023483E0CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000023484975760>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000234829ED780, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000023486ACC360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000234B6599E40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_005')
    └ <function process_job at 0x00000234B6599DA0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_005'
    └ <function registrar_evento at 0x00000234859E2160>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-11-12 17:24:20.072 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-11-12 17:24:20.072 | INFO     | log_service:registrar_evento:164 - [11] WATCHER
2025-11-12 17:24:20.082 | INFO     | log_service:registrar_evento:164 - [11] WATCHER
2025-11-12 17:24:20.084 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\11\manifest.json (exists=True)
2025-11-12 17:24:20.086 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-12 17:24:20.087 | ERROR    | watcher:process_job:162 - [11] Erro durante o processamento do job: Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000023480D02340>
    └ <Thread(ScriptRunner.scriptThread, started 21884)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000023480D020C0>
    └ <Thread(ScriptRunner.scriptThread, started 21884)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 21884)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 21884)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='1d8d65bc-b1ae-464d-b7a4-083be2e8f19f', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 21884)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000023483DE2F20>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000023483E5DBC0>
    └ ScriptRunner(_session_id='1d8d65bc-b1ae-464d-b7a4-083be2e8f19f', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='1d8d65bc-b1ae-464d-b7a4-083be2e8f19f', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000023484975760>
        └ <function exec_func_with_error_handling at 0x0000023483E0CB80>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000023484975760>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000234829ED780, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000023486ACC360>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000234B6599E40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/2025/11')
    └ <function process_job at 0x00000234B6599DA0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ WindowsPath('processing/11')
              │         │      └ <function load_manifest at 0x0000023486BE8EA0>
              │         └ typing.Any
              └ typing.Dict

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\manifest_loader.py", line 250, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']"

RuntimeError: Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']
2025-11-12 17:24:20.092 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: Arquivos listados no manifest não encontrados: ['ii_alteracao_contratual_bmf_turismo.pdf', 'fernando_de_lima_vila_nova.pdf']
2025-11-12 19:57:15.057 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 19:57:15.067 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 19:57:15.075 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 19:57:15.076 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-12 19:57:15.089 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 19:57:15.089 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-12 19:57:15.094 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 19:57:15.100 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-12 19:57:15.101 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-12 19:57:15.103 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-12 19:57:15.104 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-13 06:50:12.533 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-13 06:50:12.542 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-13 06:50:12.552 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-13 06:50:12.553 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-13 06:50:12.562 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-13 06:50:12.563 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-13 06:50:12.569 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-13 06:50:12.576 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-13 06:50:12.576 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-13 06:50:12.581 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-13 06:50:12.582 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-13 06:58:47.848 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-13 06:58:47.874 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_006] WATCHER
2025-11-13 06:58:47.890 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_006] WATCHER
2025-11-13 06:58:47.896 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_006\manifest.json (exists=True)
2025-11-13 06:58:47.912 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-13 06:58:47.960 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_006' → 'manifest.normalizado.json'
2025-11-13 06:58:47.963 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_006] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-11-13 06:58:47.964 | INFO     | watcher:process_job:124 - [job_bmf_turismo_006] Iniciando OCR/Docling…
2025-11-13 06:58:47.968 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-13 06:59:03.028 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-13 06:59:03.031 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-14 12:06:59.849 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 12:06:59.860 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 12:06:59.869 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 12:06:59.870 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-14 12:06:59.877 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 12:06:59.878 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-14 12:06:59.881 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 12:06:59.887 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 12:06:59.888 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-14 12:06:59.891 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-14 12:06:59.891 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-14 12:07:49.925 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-14 12:07:49.925 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-11-14 12:07:49.930 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-11-14 12:07:49.933 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_003\manifest.json (exists=True)
2025-11-14 12:07:49.936 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-11-14 12:07:49.940 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_003' → 'manifest.normalizado.json'
2025-11-14 12:07:49.943 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_003] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-11-14 12:07:49.943 | INFO     | watcher:process_job:124 - [job_bmf_turismo_003] Iniciando OCR/Docling…
2025-11-14 12:07:49.945 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-11-14 12:08:04.685 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-11-14 12:08:04.686 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-11-14 13:49:03.441 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 13:49:03.449 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 13:49:03.456 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 13:49:03.456 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-14 13:49:03.465 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 13:49:03.466 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-14 13:49:03.469 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 13:49:03.474 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-14 13:49:03.476 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-14 13:49:03.480 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-14 13:49:03.481 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-14 14:09:09.267 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-14 14:09:09.270 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-11-23 08:11:02.412 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:02.418 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:02.423 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:02.424 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-11-23 08:11:02.429 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:02.430 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-11-23 08:11:02.433 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:02.438 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:02.439 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-23 08:11:02.441 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-23 08:11:02.441 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-23 08:11:02.444 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-23 08:11:02.445 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-11-23 08:11:28.944 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:28.945 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-23 08:11:28.946 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-23 08:11:28.946 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-23 08:11:28.948 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-23 08:11:28.949 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-11-23 08:11:47.005 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:47.007 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-23 08:11:47.010 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-23 08:11:47.011 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-23 08:11:47.014 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-23 08:11:47.014 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-11-23 08:11:57.060 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-11-23 08:11:57.060 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-11-23 08:11:57.061 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-11-23 08:11:57.062 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-11-23 08:11:57.066 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-11-23 08:11:57.066 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_003] WATCHER
2025-12-03 11:34:06.780 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 11:34:06.788 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 11:34:06.792 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 11:34:06.792 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-03 11:34:06.798 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 11:34:06.798 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-03 11:34:06.801 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 11:34:06.805 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 11:34:06.806 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-03 11:34:06.809 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-03 11:34:06.810 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-03 11:34:06.821 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-03 11:34:06.823 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_998] WATCHER
2025-12-03 11:34:06.833 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_998] WATCHER
2025-12-03 11:34:06.835 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_998\manifest.json (exists=True)
2025-12-03 11:34:06.838 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-03 11:34:06.842 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_998' → 'manifest.normalizado.json'
2025-12-03 11:34:06.843 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_998] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-03 11:34:06.844 | INFO     | watcher:process_job:124 - [job_bmf_turismo_998] Iniciando OCR/Docling…
2025-12-03 11:34:06.846 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-12-03 11:35:21.938 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-12-03 11:35:21.940 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-12-03 11:38:34.895 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-12-03 11:38:34.898 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-12-03 11:39:12.287 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-12-03 11:39:12.288 | INFO     | watcher:process_job:126 - [job_bmf_turismo_998] OCR/Docling concluído: OK
2025-12-03 11:39:12.288 | INFO     | watcher:process_job:129 - [job_bmf_turismo_998] Iniciando IA Validador 1…
2025-12-03 11:39:12.291 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-03 11:39:49.445 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_998 (padrao)
2025-12-03 11:39:49.446 | INFO     | watcher:process_job:131 - [job_bmf_turismo_998] IA1 concluída: OK
2025-12-03 11:39:49.447 | INFO     | watcher:process_job:134 - [job_bmf_turismo_998] Consultando dados ReceitaWS…
2025-12-03 11:39:49.449 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_998] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_998/serpro/manifest_for_serpro.json
2025-12-03 11:39:50.914 | INFO     | watcher:process_job:140 - [job_bmf_turismo_998] ReceitaWS concluída: OK
2025-12-03 11:39:50.915 | INFO     | watcher:process_job:143 - [job_bmf_turismo_998] Iniciando IA Validador 2 (comparativa)…
2025-12-03 11:39:50.919 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-03 11:40:28.070 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_998 (comparativo)
2025-12-03 11:40:28.071 | INFO     | watcher:process_job:150 - [job_bmf_turismo_998] IA2 concluída: OK
2025-12-03 11:40:28.072 | INFO     | watcher:process_job:153 - [job_bmf_turismo_998] Gerando relatório final…
2025-12-03 11:40:28.080 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_998\resultado
2025-12-03 11:40:28.081 | INFO     | watcher:process_job:155 - [job_bmf_turismo_998] Relatório final gerado.
2025-12-03 11:40:28.084 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_998] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x0000025A41F42340>
    └ <Thread(ScriptRunner.scriptThread, started 24104)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x0000025A41F420C0>
    └ <Thread(ScriptRunner.scriptThread, started 24104)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 24104)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 24104)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='75bc0086-c14a-4882-a843-3a9129447046', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 24104)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000025A448729D0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000025A454645E0>
    └ ScriptRunner(_session_id='75bc0086-c14a-4882-a843-3a9129447046', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='75bc0086-c14a-4882-a843-3a9129447046', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000025A45CA80E0>
        └ <function exec_func_with_error_handling at 0x0000025A453DF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000025A45CA80E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x0000025A44E121D0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x0000025A47DAEAC0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x0000025A77839120>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_998')
    └ <function process_job at 0x0000025A77839080>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_998'
    └ <function registrar_evento at 0x0000025A46D3C7C0>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-03 11:40:28.091 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-03 13:23:31.523 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:23:31.533 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:23:31.541 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:23:31.542 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-03 13:23:31.550 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:23:31.551 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-03 13:23:31.556 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:23:31.561 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:24:09.997 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:24:55.712 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:25:04.395 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:25:21.850 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:27:00.080 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:27:49.419 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:27:56.438 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:28:03.645 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:28:37.413 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:28:39.012 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:28:41.180 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:28:58.235 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:29:05.418 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:30:53.044 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:32:03.470 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:32:10.361 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:32:12.008 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:32:33.501 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:32:54.235 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:33:00.636 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:33:03.821 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-03 13:33:07.014 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.033 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.037 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.040 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.040 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-05 09:55:50.043 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.043 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-05 09:55:50.044 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.047 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:55:50.047 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-05 09:55:50.048 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-05 09:55:50.048 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-05 09:55:50.049 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-05 09:55:50.049 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_997] WATCHER
2025-12-05 09:55:50.051 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_997] WATCHER
2025-12-05 09:55:50.052 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_997\manifest.json (exists=True)
2025-12-05 09:55:50.054 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-05 09:55:50.057 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_997' → 'manifest.normalizado.json'
2025-12-05 09:55:50.058 | INFO     | watcher:process_job:124 - [job_bmf_turismo_997] Iniciando OCR/Docling…
2025-12-05 09:55:50.059 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-12-05 09:56:00.666 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-12-05 09:56:00.667 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-12-05 09:57:54.775 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.777 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.779 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.779 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-05 09:57:54.781 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.781 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-05 09:57:54.783 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.789 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.789 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 09:57:54.789 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-05 09:57:54.790 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-05 09:57:54.791 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-05 09:57:54.792 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-05 09:57:54.792 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-05 09:57:54.792 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-05 10:18:25.293 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-05 10:18:25.294 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_996] WATCHER
2025-12-05 10:18:25.296 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-05 10:18:25.296 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_996] WATCHER
2025-12-05 10:18:25.299 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_996] WATCHER
2025-12-05 10:18:25.300 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_996\manifest.json (exists=True)
2025-12-05 10:18:25.303 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-05 10:18:25.310 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_996' → 'manifest.normalizado.json'
2025-12-05 10:18:25.314 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_996] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-05 10:18:25.315 | INFO     | watcher:process_job:124 - [job_bmf_turismo_996] Iniciando OCR/Docling…
2025-12-05 10:18:25.320 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de cartao_cnpj.pdf
2025-12-05 10:18:41.637 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: cartao_cnpj.pdf via Docling
2025-12-05 10:18:41.640 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de ii_alteracao_contratual_bmf_turismo.pdf
2025-12-05 10:26:33.353 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: ii_alteracao_contratual_bmf_turismo.pdf via Docling
2025-12-05 10:26:33.357 | INFO     | extrator_docling:executar_ocr:59 - Iniciando extração de fernando_de_lima_vila_nova.pdf
2025-12-05 10:29:13.065 | INFO     | extrator_docling:executar_ocr:85 - Extração concluída: fernando_de_lima_vila_nova.pdf via Docling
2025-12-05 10:29:13.068 | INFO     | watcher:process_job:126 - [job_bmf_turismo_996] OCR/Docling concluído: OK
2025-12-05 10:29:13.070 | INFO     | watcher:process_job:129 - [job_bmf_turismo_996] Iniciando IA Validador 1…
2025-12-05 10:29:13.075 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 10:29:54.723 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_996 (padrao)
2025-12-05 10:29:54.724 | INFO     | watcher:process_job:131 - [job_bmf_turismo_996] IA1 concluída: OK
2025-12-05 10:29:54.725 | INFO     | watcher:process_job:134 - [job_bmf_turismo_996] Consultando dados ReceitaWS…
2025-12-05 10:29:54.731 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_996] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_996/serpro/manifest_for_serpro.json
2025-12-05 10:29:58.161 | INFO     | watcher:process_job:140 - [job_bmf_turismo_996] ReceitaWS concluída: OK
2025-12-05 10:29:58.163 | INFO     | watcher:process_job:143 - [job_bmf_turismo_996] Iniciando IA Validador 2 (comparativa)…
2025-12-05 10:29:58.167 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 10:30:29.491 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_996 (comparativo)
2025-12-05 10:30:29.496 | INFO     | watcher:process_job:150 - [job_bmf_turismo_996] IA2 concluída: OK
2025-12-05 10:30:29.496 | INFO     | watcher:process_job:153 - [job_bmf_turismo_996] Gerando relatório final…
2025-12-05 10:30:29.519 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_996\resultado
2025-12-05 10:30:29.523 | INFO     | watcher:process_job:155 - [job_bmf_turismo_996] Relatório final gerado.
2025-12-05 10:30:29.533 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_996] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000180E0B72340>
    └ <Thread(ScriptRunner.scriptThread, started 19124)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x00000180E0B720C0>
    └ <Thread(ScriptRunner.scriptThread, started 19124)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 19124)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 19124)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='2fab3e76-3efd-443e-b81c-cc5bc53b77e0', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 19124)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x00000180E3352B60>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x00000180E3F445E0>
    └ ScriptRunner(_session_id='2fab3e76-3efd-443e-b81c-cc5bc53b77e0', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='2fab3e76-3efd-443e-b81c-cc5bc53b77e0', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000180E47C3CE0>
        └ <function exec_func_with_error_handling at 0x00000180E3EBF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000180E47C3CE0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000180E3954230, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001809672D620>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001809672D580>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_996')
    └ <function process_job at 0x000001809672D4E0>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_996'
    └ <function registrar_evento at 0x00000180E588C400>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 10:30:29.566 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 11:47:35.560 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 11:47:56.041 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 11:47:56.043 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 11:47:56.045 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 11:47:56.047 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 11:47:56.047 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-05 11:47:56.050 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 11:47:56.050 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-05 11:47:56.052 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:31:24.330 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.560 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.565 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.572 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.578 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.578 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-05 14:32:02.587 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.588 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-05 14:32:02.592 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.597 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 14:32:02.597 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-05 14:32:02.599 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-05 14:32:02.599 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-05 14:32:17.606 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-05 14:32:17.606 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_995] WATCHER
2025-12-05 14:32:17.612 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_995] WATCHER
2025-12-05 14:32:17.614 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_995\manifest.json (exists=True)
2025-12-05 14:32:17.621 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-05 14:32:17.625 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_995' → 'manifest.normalizado.json'
2025-12-05 14:32:17.626 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_995] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-05 14:32:17.626 | INFO     | watcher:process_job:124 - [job_bmf_turismo_995] Iniciando OCR/Docling…
2025-12-05 14:32:17.627 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-05 14:32:17.628 | INFO     | ocr_router:executar_ocr:63 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-05 14:32:31.858 | INFO     | ocr_router:executar_ocr:63 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-05 14:36:16.275 | INFO     | ocr_router:executar_ocr:63 - Roteando fernando_de_lima_vila_nova.pdf para Pipeline Padrão (Docling).
2025-12-05 14:37:07.483 | INFO     | watcher:process_job:126 - [job_bmf_turismo_995] OCR/Docling concluído: OK
2025-12-05 14:37:07.484 | INFO     | watcher:process_job:129 - [job_bmf_turismo_995] Iniciando IA Validador 1…
2025-12-05 14:37:07.489 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 14:37:40.013 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_995 (padrao)
2025-12-05 14:37:40.013 | INFO     | watcher:process_job:131 - [job_bmf_turismo_995] IA1 concluída: OK
2025-12-05 14:37:40.014 | INFO     | watcher:process_job:134 - [job_bmf_turismo_995] Consultando dados ReceitaWS…
2025-12-05 14:37:40.016 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_995] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_995/serpro/manifest_for_serpro.json
2025-12-05 14:37:41.186 | INFO     | watcher:process_job:140 - [job_bmf_turismo_995] ReceitaWS concluída: OK
2025-12-05 14:37:41.186 | INFO     | watcher:process_job:143 - [job_bmf_turismo_995] Iniciando IA Validador 2 (comparativa)…
2025-12-05 14:37:41.188 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 14:38:06.609 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_995 (comparativo)
2025-12-05 14:38:06.609 | INFO     | watcher:process_job:150 - [job_bmf_turismo_995] IA2 concluída: OK
2025-12-05 14:38:06.609 | INFO     | watcher:process_job:153 - [job_bmf_turismo_995] Gerando relatório final…
2025-12-05 14:38:06.615 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_995\resultado
2025-12-05 14:38:06.616 | INFO     | watcher:process_job:155 - [job_bmf_turismo_995] Relatório final gerado.
2025-12-05 14:38:06.618 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_995] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EE37322340>
    └ <Thread(ScriptRunner.scriptThread, started 33336)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001EE373220C0>
    └ <Thread(ScriptRunner.scriptThread, started 33336)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 33336)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 33336)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='04c7e816-c997-4cf2-a142-a643609d432d', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 33336)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001EE39B92C50>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001EE3A7845E0>
    └ ScriptRunner(_session_id='04c7e816-c997-4cf2-a142-a643609d432d', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='04c7e816-c997-4cf2-a142-a643609d432d', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001EE3AFC4180>
        └ <function exec_func_with_error_handling at 0x000001EE3A6FF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001EE3AFC4180>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001EE38DD3420, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001EE3D0ADE40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001EE6D6A34C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_995')
    └ <function process_job at 0x000001EE6D6A3420>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_995'
    └ <function registrar_evento at 0x000001EE3C038860>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 14:38:06.623 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 14:47:11.829 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-05 14:47:11.830 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_994] WATCHER
2025-12-05 14:47:11.833 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_994] WATCHER
2025-12-05 14:47:11.834 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_994\manifest.json (exists=True)
2025-12-05 14:47:11.836 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-05 14:47:11.843 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_994' → 'manifest.normalizado.json'
2025-12-05 14:47:11.843 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_994] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-05 14:47:11.843 | INFO     | watcher:process_job:124 - [job_bmf_turismo_994] Iniciando OCR/Docling…
2025-12-05 14:47:11.844 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-05 14:47:11.846 | INFO     | ocr_router:executar_ocr:63 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-05 14:47:13.637 | WARNING  | extrator_docling:extrair_com_docling:122 - Docling falhou: cannot schedule new futures after interpreter shutdown
2025-12-05 14:47:16.970 | INFO     | ocr_router:executar_ocr:63 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-05 14:47:18.388 | WARNING  | extrator_docling:extrair_com_docling:122 - Docling falhou: cannot schedule new futures after interpreter shutdown
2025-12-05 14:47:51.898 | INFO     | ocr_router:executar_ocr:42 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-05 14:47:52.525 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing\job_bmf_turismo_994\fernando_de_lima_vila_nova.pdf
2025-12-05 14:47:54.929 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_994/a3 (OCR_CNH) → OK
2025-12-05 14:47:54.938 | INFO     | watcher:process_job:126 - [job_bmf_turismo_994] OCR/Docling concluído: OK
2025-12-05 14:47:54.939 | INFO     | watcher:process_job:129 - [job_bmf_turismo_994] Iniciando IA Validador 1…
2025-12-05 14:47:54.942 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 14:48:25.408 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_994 (padrao)
2025-12-05 14:48:25.409 | INFO     | watcher:process_job:131 - [job_bmf_turismo_994] IA1 concluída: OK
2025-12-05 14:48:25.409 | INFO     | watcher:process_job:134 - [job_bmf_turismo_994] Consultando dados ReceitaWS…
2025-12-05 14:48:25.412 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_994] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_994/serpro/manifest_for_serpro.json
2025-12-05 14:48:26.379 | INFO     | watcher:process_job:140 - [job_bmf_turismo_994] ReceitaWS concluída: OK
2025-12-05 14:48:26.379 | INFO     | watcher:process_job:143 - [job_bmf_turismo_994] Iniciando IA Validador 2 (comparativa)…
2025-12-05 14:48:26.381 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 14:48:54.509 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_994 (comparativo)
2025-12-05 14:48:54.511 | INFO     | watcher:process_job:150 - [job_bmf_turismo_994] IA2 concluída: OK
2025-12-05 14:48:54.511 | INFO     | watcher:process_job:153 - [job_bmf_turismo_994] Gerando relatório final…
2025-12-05 14:48:54.524 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_994\resultado
2025-12-05 14:48:54.524 | INFO     | watcher:process_job:155 - [job_bmf_turismo_994] Relatório final gerado.
2025-12-05 14:48:54.528 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_994] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001EE37322340>
    └ <Thread(ScriptRunner.scriptThread, started 33336)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001EE373220C0>
    └ <Thread(ScriptRunner.scriptThread, started 33336)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 33336)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 33336)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='04c7e816-c997-4cf2-a142-a643609d432d', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 33336)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001EE39B92C50>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001EE3A7845E0>
    └ ScriptRunner(_session_id='04c7e816-c997-4cf2-a142-a643609d432d', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='04c7e816-c997-4cf2-a142-a643609d432d', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001EE3AFC4180>
        └ <function exec_func_with_error_handling at 0x000001EE3A6FF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001EE3AFC4180>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001EE38DD3420, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001EE3D0ADE40>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001EE6D6A34C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_994')
    └ <function process_job at 0x000001EE6D6A3420>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_994'
    └ <function registrar_evento at 0x000001EE3C038860>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 14:48:54.532 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 15:00:58.689 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.251 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.254 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.258 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.263 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.263 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-05 15:01:15.268 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.268 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-05 15:01:15.271 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.277 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-05 15:01:15.278 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-05 15:01:15.279 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-05 15:01:15.280 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-05 15:01:45.292 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-05 15:01:45.293 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_994] WATCHER
2025-12-05 15:01:45.295 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_994] WATCHER
2025-12-05 15:01:45.296 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_994\manifest.json (exists=True)
2025-12-05 15:01:45.298 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-05 15:01:45.301 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_994' → 'manifest.normalizado.json'
2025-12-05 15:01:45.303 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_994] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-05 15:01:45.305 | INFO     | watcher:process_job:124 - [job_bmf_turismo_994] Iniciando OCR/Docling…
2025-12-05 15:01:45.306 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-05 15:01:45.307 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-05 15:01:51.445 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-05 15:06:12.422 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-05 15:06:13.140 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing\job_bmf_turismo_994\fernando_de_lima_vila_nova.pdf
2025-12-05 15:06:15.537 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_994/a3 (OCR_CNH) → OK
2025-12-05 15:06:15.553 | INFO     | watcher:process_job:126 - [job_bmf_turismo_994] OCR/Docling concluído: OK
2025-12-05 15:06:15.554 | INFO     | watcher:process_job:129 - [job_bmf_turismo_994] Iniciando IA Validador 1…
2025-12-05 15:06:15.558 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 15:06:48.309 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_994 (padrao)
2025-12-05 15:06:48.311 | INFO     | watcher:process_job:131 - [job_bmf_turismo_994] IA1 concluída: OK
2025-12-05 15:06:48.312 | INFO     | watcher:process_job:134 - [job_bmf_turismo_994] Consultando dados ReceitaWS…
2025-12-05 15:06:48.315 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_994] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_994/serpro/manifest_for_serpro.json
2025-12-05 15:06:49.778 | INFO     | watcher:process_job:140 - [job_bmf_turismo_994] ReceitaWS concluída: OK
2025-12-05 15:06:49.780 | INFO     | watcher:process_job:143 - [job_bmf_turismo_994] Iniciando IA Validador 2 (comparativa)…
2025-12-05 15:06:49.784 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-05 15:07:18.975 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_994 (comparativo)
2025-12-05 15:07:18.976 | INFO     | watcher:process_job:150 - [job_bmf_turismo_994] IA2 concluída: OK
2025-12-05 15:07:18.977 | INFO     | watcher:process_job:153 - [job_bmf_turismo_994] Gerando relatório final…
2025-12-05 15:07:18.987 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_994\resultado
2025-12-05 15:07:18.988 | INFO     | watcher:process_job:155 - [job_bmf_turismo_994] Relatório final gerado.
2025-12-05 15:07:19.020 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_994] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000201F0F22340>
    └ <Thread(ScriptRunner.scriptThread, started 11048)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x00000201F0F220C0>
    └ <Thread(ScriptRunner.scriptThread, started 11048)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 11048)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 11048)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='b8009e62-6d56-43e4-9733-175f648f0808', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 11048)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x00000201F37F2CA0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x00000201F43E45E0>
    └ ScriptRunner(_session_id='b8009e62-6d56-43e4-9733-175f648f0808', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='b8009e62-6d56-43e4-9733-175f648f0808', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000201F4BFFE20>
        └ <function exec_func_with_error_handling at 0x00000201F435F740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x00000201F4BFFE20>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000201F3CC50A0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x00000201F6D2A840>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000201A75F3E20>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_994')
    └ <function process_job at 0x00000201A75F3D80>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_994'
    └ <function registrar_evento at 0x00000201F4CEC540>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-05 15:07:19.033 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-08 11:31:50.231 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.412 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.414 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.417 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.420 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.421 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-08 11:32:24.424 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.424 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-08 11:32:24.427 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.430 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-08 11:32:24.430 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-08 11:32:24.431 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-08 11:32:24.432 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-10 15:48:03.648 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-10 15:48:04.253 | INFO     | __main__:process_cnh:75 - Processando página 1 de C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\Ocr_teste_cnh\cnh_mateus.pdf
2025-12-10 15:48:06.567 | INFO     | ledger:register_entry:68 - Ledger atualizado: test_manual_job/test_file_001 (OCR_CNH) → OK
2025-12-11 17:54:13.304 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.089 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.093 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.102 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.113 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.114 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-11 17:54:59.123 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.124 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-11 17:54:59.128 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.136 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-11 17:54:59.137 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-11 17:54:59.139 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-11 17:54:59.139 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-11 17:55:24.151 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-11 17:55:24.151 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_993] WATCHER
2025-12-11 17:55:24.156 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_993] WATCHER
2025-12-11 17:55:24.158 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_993\manifest.json (exists=True)
2025-12-11 17:55:24.161 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-11 17:55:24.165 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_993' → 'manifest.normalizado.json'
2025-12-11 17:55:24.167 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_993] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-11 17:55:24.167 | INFO     | watcher:process_job:124 - [job_bmf_turismo_993] Iniciando OCR/Docling…
2025-12-11 17:55:24.169 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-11 17:55:24.171 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-11 17:55:38.877 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-11 17:59:34.120 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-11 17:59:34.757 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing\job_bmf_turismo_993\fernando_de_lima_vila_nova.pdf
2025-12-11 17:59:37.804 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_993/a3 (OCR_CNH) → OK
2025-12-11 17:59:37.813 | INFO     | watcher:process_job:126 - [job_bmf_turismo_993] OCR/Docling concluído: OK
2025-12-11 17:59:37.814 | INFO     | watcher:process_job:129 - [job_bmf_turismo_993] Iniciando IA Validador 1…
2025-12-11 17:59:37.817 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-11 18:00:05.519 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_993 (padrao)
2025-12-11 18:00:05.521 | INFO     | watcher:process_job:131 - [job_bmf_turismo_993] IA1 concluída: OK
2025-12-11 18:00:05.521 | INFO     | watcher:process_job:134 - [job_bmf_turismo_993] Consultando dados ReceitaWS…
2025-12-11 18:00:05.525 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_993] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_993/serpro/manifest_for_serpro.json
2025-12-11 18:00:07.524 | INFO     | watcher:process_job:140 - [job_bmf_turismo_993] ReceitaWS concluída: OK
2025-12-11 18:00:07.525 | INFO     | watcher:process_job:143 - [job_bmf_turismo_993] Iniciando IA Validador 2 (comparativa)…
2025-12-11 18:00:07.527 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-11 18:00:35.065 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_993 (comparativo)
2025-12-11 18:00:35.066 | INFO     | watcher:process_job:150 - [job_bmf_turismo_993] IA2 concluída: OK
2025-12-11 18:00:35.066 | INFO     | watcher:process_job:153 - [job_bmf_turismo_993] Gerando relatório final…
2025-12-11 18:00:35.077 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_993\resultado
2025-12-11 18:00:35.077 | INFO     | watcher:process_job:155 - [job_bmf_turismo_993] Relatório final gerado.
2025-12-11 18:00:35.082 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_993] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001B044772340>
    └ <Thread(ScriptRunner.scriptThread, started 27008)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001B0447720C0>
    └ <Thread(ScriptRunner.scriptThread, started 27008)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 27008)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 27008)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='1a9d0cb1-ba59-42a9-928f-97b9d7210b4d', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 27008)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001B046FD2CF0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001B047BD45E0>
    └ ScriptRunner(_session_id='1a9d0cb1-ba59-42a9-928f-97b9d7210b4d', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='1a9d0cb1-ba59-42a9-928f-97b9d7210b4d', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001B0484780E0>
        └ <function exec_func_with_error_handling at 0x000001B047B4F740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001B0484780E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001B046625CA0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001B04A5AEAC0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001B07A3180E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_993')
    └ <function process_job at 0x000001B07A318040>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_993'
    └ <function registrar_evento at 0x000001B0495207C0>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-11 18:00:35.091 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-14 08:57:20.314 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.882 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.887 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.895 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.903 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.905 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-14 08:58:11.911 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.911 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-14 08:58:11.916 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.924 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-14 08:58:11.925 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-14 08:58:11.928 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-14 08:58:11.929 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-14 09:19:07.536 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-14 09:19:07.543 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_992] WATCHER
2025-12-14 09:19:07.595 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_992] WATCHER
2025-12-14 09:19:07.600 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_992\manifest.json (exists=True)
2025-12-14 09:19:07.620 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-14 09:19:07.630 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_992' → 'manifest.normalizado.json'
2025-12-14 09:19:07.632 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_992] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-14 09:19:07.636 | INFO     | watcher:process_job:124 - [job_bmf_turismo_992] Iniciando OCR/Docling…
2025-12-14 09:19:07.638 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-14 09:19:07.642 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-14 09:19:24.441 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-14 09:24:00.967 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-14 09:24:03.942 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing\job_bmf_turismo_992\fernando_de_lima_vila_nova.pdf
2025-12-14 09:24:10.871 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_992/a3 (OCR_CNH) → OK
2025-12-14 09:24:10.886 | INFO     | watcher:process_job:126 - [job_bmf_turismo_992] OCR/Docling concluído: OK
2025-12-14 09:24:10.887 | INFO     | watcher:process_job:129 - [job_bmf_turismo_992] Iniciando IA Validador 1…
2025-12-14 09:24:10.891 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-14 09:24:34.597 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_992 (padrao)
2025-12-14 09:24:34.597 | INFO     | watcher:process_job:131 - [job_bmf_turismo_992] IA1 concluída: OK
2025-12-14 09:24:34.598 | INFO     | watcher:process_job:134 - [job_bmf_turismo_992] Consultando dados ReceitaWS…
2025-12-14 09:24:34.602 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_992] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_992/serpro/manifest_for_serpro.json
2025-12-14 09:24:36.340 | INFO     | watcher:process_job:140 - [job_bmf_turismo_992] ReceitaWS concluída: OK
2025-12-14 09:24:36.341 | INFO     | watcher:process_job:143 - [job_bmf_turismo_992] Iniciando IA Validador 2 (comparativa)…
2025-12-14 09:24:36.343 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-14 09:24:59.359 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_992 (comparativo)
2025-12-14 09:24:59.360 | INFO     | watcher:process_job:150 - [job_bmf_turismo_992] IA2 concluída: OK
2025-12-14 09:24:59.360 | INFO     | watcher:process_job:153 - [job_bmf_turismo_992] Gerando relatório final…
2025-12-14 09:24:59.370 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\job_bmf_turismo_992\resultado
2025-12-14 09:24:59.371 | INFO     | watcher:process_job:155 - [job_bmf_turismo_992] Relatório final gerado.
2025-12-14 09:24:59.374 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_992] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x00000164642D2340>
    └ <Thread(ScriptRunner.scriptThread, started 31316)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x00000164642D20C0>
    └ <Thread(ScriptRunner.scriptThread, started 31316)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 31316)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 31316)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='3d9cd17d-2230-4001-97c7-1eab7bcad647', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 31316)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x0000016466B52CF0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x00000164677545E0>
    └ ScriptRunner(_session_id='3d9cd17d-2230-4001-97c7-1eab7bcad647', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='3d9cd17d-2230-4001-97c7-1eab7bcad647', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000016467FDC0E0>
        └ <function exec_func_with_error_handling at 0x00000164676CF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x0000016467FDC0E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000164671B45D0, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001646A12EAC0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001641A1980E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/job_bmf_turismo_992')
    └ <function process_job at 0x000001641A198040>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_992'
    └ <function registrar_evento at 0x00000164690A07C0>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-14 09:24:59.379 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-16 08:36:47.661 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.182 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.188 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.198 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.210 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.211 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-16 08:37:36.219 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.220 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-16 08:37:36.227 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.238 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-16 08:37:36.239 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-16 08:37:36.242 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-16 08:37:36.243 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-17 07:21:53.706 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.409 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.410 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.413 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.416 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.416 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-17 07:22:25.420 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.420 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2025-12-17 07:22:25.422 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.424 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 07:22:25.424 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-17 07:22:25.426 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-17 07:22:25.426 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-17 07:22:25.427 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-17 07:22:25.427 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_991] WATCHER
2025-12-17 07:22:25.430 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_991] WATCHER
2025-12-17 07:22:25.431 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\job_bmf_turismo_991\manifest.json (exists=True)
2025-12-17 07:22:25.433 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-17 07:22:25.437 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_991' → 'manifest.normalizado.json'
2025-12-17 07:22:25.438 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_991] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-17 07:22:25.438 | INFO     | watcher:process_job:124 - [job_bmf_turismo_991] Iniciando OCR/Docling…
2025-12-17 07:22:25.440 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-17 07:22:25.441 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-17 07:22:31.133 | WARNING  | extrator_docling:extrair_com_docling:122 - Docling falhou: cannot schedule new futures after interpreter shutdown
2025-12-17 07:22:33.022 | WARNING  | extrator_docling:extrair_com_tesseract:135 - Erro no OCR Tesseract: (3221225786, 'ObjectCache(00007ffbf6b44560)::~ObjectCache(): WARNING! LEAK! object 0000020393e70f60 still has count 1 (id C:\\Tesseract\\tessdata\\por.traineddatalstm-punc-dawg) ObjectCache(00007ffbf6b44560)::~ObjectCache(): WARNING! LEAK! object 00000203938edbc0 still has count 1 (id C:\\Tesseract\\tessdata\\por.traineddatalstm-word-dawg) ObjectCache(00007ffbf6b44560)::~ObjectCache(): WARNING! LEAK! object 00000203938edc30 still has count 1 (id C:\\Tesseract\\tessdata\\por.traineddatalstm-number-dawg) ObjectCache(00007ffbf6b44560)::~ObjectCache(): WARNING! LEAK! object 0000020393db3860 still has count 1 (id C:\\Tesseract\\tessdata\\eng.traineddatalstm-punc-dawg) ObjectCache(00007ffbf6b44560)::~ObjectCache(): WARNING! LEAK! object 00000203949d2370 still has count 1 (id C:\\Tesseract\\tessdata\\eng.traineddatalstm-word-dawg) ObjectCache(00007ffbf6b44560)::~ObjectCache(): WARNING! LEAK! object 000002039395ed00 still has count 1 (id C:\\Tesseract\\tessdata\\eng.traineddatalstm-number-dawg)')
2025-12-17 07:22:33.026 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-17 10:23:09.967 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.457 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.464 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.485 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.505 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.505 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-17 10:23:19.522 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.523 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-17 10:23:19.530 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.538 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-17 10:23:19.538 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-17 10:23:19.539 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-17 10:23:19.539 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-17 10:23:19.548 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-17 10:23:19.549 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_899] WATCHER
2025-12-17 10:23:19.564 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_899] WATCHER
2025-12-17 10:23:19.567 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_899/manifest.json (exists=True)
2025-12-17 10:23:19.577 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-17 10:23:19.587 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_899' → 'manifest.normalizado.json'
2025-12-17 10:23:19.587 | INFO     | watcher:process_job:124 - [job_bmf_turismo_899] Iniciando OCR/Docling…
2025-12-17 10:23:19.590 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-17 10:23:19.594 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-17 10:24:11.730 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-17 10:27:40.404 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-17 10:27:41.130 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing/job_bmf_turismo_899/fernando_de_lima_vila_nova.pdf
2025-12-17 10:27:41.550 | WARNING  | cnh_ocr:_extract_page_content:184 - Erro no OCR PSM 3: (1, 'Error opening data file /usr/share/tesseract-ocr/5/tessdata/por.traineddata Please make sure the TESSDATA_PREFIX environment variable is set to your "tessdata" directory. Failed loading language \'por\' Tesseract couldn\'t load any languages! Could not initialize tesseract.')
2025-12-17 10:27:42.121 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_899/a3 (OCR_CNH) → OK
2025-12-17 10:27:42.130 | INFO     | watcher:process_job:126 - [job_bmf_turismo_899] OCR/Docling concluído: OK
2025-12-17 10:27:42.130 | INFO     | watcher:process_job:129 - [job_bmf_turismo_899] Iniciando IA Validador 1…
2025-12-17 10:27:42.144 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-17 10:28:09.104 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_899 (padrao)
2025-12-17 10:28:09.105 | INFO     | watcher:process_job:131 - [job_bmf_turismo_899] IA1 concluída: OK
2025-12-17 10:28:09.105 | INFO     | watcher:process_job:134 - [job_bmf_turismo_899] Consultando dados ReceitaWS…
2025-12-17 10:28:09.111 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_899] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_899/serpro/manifest_for_serpro.json
2025-12-17 10:28:09.487 | INFO     | consulta_serpro:_mark_manifest_done:67 - [RECEITAWS] Manifesto marcado como done: outbox/job_bmf_turismo_899/serpro/manifest_for_serpro.done.json
2025-12-17 10:28:09.487 | INFO     | watcher:process_job:140 - [job_bmf_turismo_899] ReceitaWS concluída: OK
2025-12-17 10:28:09.488 | INFO     | watcher:process_job:143 - [job_bmf_turismo_899] Iniciando IA Validador 2 (comparativa)…
2025-12-17 10:28:09.493 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-17 10:28:42.951 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_899 (comparativo)
2025-12-17 10:28:42.952 | INFO     | watcher:process_job:150 - [job_bmf_turismo_899] IA2 concluída: OK
2025-12-17 10:28:42.952 | INFO     | watcher:process_job:153 - [job_bmf_turismo_899] Gerando relatório final…
2025-12-17 10:28:42.982 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_899/resultado
2025-12-17 10:28:42.982 | INFO     | watcher:process_job:155 - [job_bmf_turismo_899] Relatório final gerado.
2025-12-17 10:28:42.988 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_899] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x77a00d389ee0>
    └ <Thread(ScriptRunner.scriptThread, started 131529237939904)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x77a00d389bc0>
    └ <Thread(ScriptRunner.scriptThread, started 131529237939904)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 131529237939904)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 131529237939904)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='a6cdba6b-93f5-431f-be39-19f6699663ce', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 131529237939904)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x77a00bc90fe0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, page_script_hash='5bc02cefb3ea9e...
    │    └ <function ScriptRunner._run_script at 0x77a00bd828e0>
    └ ScriptRunner(_session_id='a6cdba6b-93f5-431f-be39-19f6699663ce', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='a6cdba6b-93f5-431f-be39-19f6699663ce', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x77a00b2c4b80>
        └ <function exec_func_with_error_handling at 0x77a00bd16840>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x77a00b2c4b80>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x779ff400e730, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x779ff2c8f100>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x779e855c8180>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_899')
    └ <function process_job at 0x779e855c80e0>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_899'
    └ <function registrar_evento at 0x77a00a8d6fc0>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-17 10:28:42.994 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-18 15:39:58.244 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.913 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.923 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.934 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.946 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.946 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 15:40:06.957 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.958 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 15:40:06.965 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.974 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:40:06.974 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 15:40:06.975 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 15:40:06.976 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 15:47:06.612 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.209 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.219 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.230 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.243 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.243 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 15:47:11.256 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.256 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 15:47:11.265 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.275 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:47:11.275 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 15:47:11.276 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 15:47:11.276 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 15:58:46.876 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.576 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.585 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.605 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.621 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.621 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 15:58:54.641 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.641 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 15:58:54.661 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.678 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 15:58:54.679 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 15:58:54.679 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 15:58:54.680 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 18:13:24.902 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.331 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.364 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.410 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.433 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.433 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 18:13:33.448 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.448 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 18:13:33.459 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.471 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:13:33.471 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 18:13:33.471 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 18:13:33.472 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 18:13:33.482 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-18 18:13:33.483 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_898] WATCHER
2025-12-18 18:13:33.500 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_898] WATCHER
2025-12-18 18:13:33.503 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_898/manifest.json (exists=True)
2025-12-18 18:13:33.515 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-18 18:13:33.522 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_898' → 'manifest.normalizado.json'
2025-12-18 18:13:33.523 | INFO     | watcher:process_job:124 - [job_bmf_turismo_898] Iniciando OCR/Docling…
2025-12-18 18:13:33.527 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-18 18:13:33.531 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-18 18:14:02.015 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-18 18:29:03.792 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.447 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.458 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.478 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.494 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.495 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 18:29:13.509 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.509 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 18:29:13.518 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.530 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:29:13.530 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 18:29:13.531 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 18:29:13.531 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 18:36:22.541 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.521 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.539 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.561 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.585 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.585 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 18:36:30.609 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.610 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 18:36:30.630 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.651 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 18:36:30.652 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 18:36:30.652 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 18:36:30.653 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 19:20:31.372 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.107 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.119 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.135 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.154 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.154 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-18 19:20:44.172 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.173 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-18 19:20:44.185 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.199 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-18 19:20:44.200 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-18 19:20:44.200 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-18 19:20:44.200 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-18 19:20:44.214 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-18 19:20:44.214 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_998] WATCHER
2025-12-18 19:20:44.233 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_998] WATCHER
2025-12-18 19:20:44.236 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_998/manifest.json (exists=True)
2025-12-18 19:20:44.248 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-18 19:20:44.258 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_998' → 'manifest.normalizado.json'
2025-12-18 19:20:44.259 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_998] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-18 19:20:44.259 | INFO     | watcher:process_job:124 - [job_bmf_turismo_998] Iniciando OCR/Docling…
2025-12-18 19:20:44.264 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-18 19:20:44.269 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-18 19:21:17.643 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-18 19:24:30.784 | INFO     | ocr_router:executar_ocr:71 - Roteando fernando_de_lima_vila_nova.pdf para Pipeline Padrão (Docling).
2025-12-18 19:25:28.057 | INFO     | watcher:process_job:126 - [job_bmf_turismo_998] OCR/Docling concluído: OK
2025-12-18 19:25:28.057 | INFO     | watcher:process_job:129 - [job_bmf_turismo_998] Iniciando IA Validador 1…
2025-12-18 19:25:28.087 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-18 19:25:50.300 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_998 (padrao)
2025-12-18 19:25:50.301 | INFO     | watcher:process_job:131 - [job_bmf_turismo_998] IA1 concluída: OK
2025-12-18 19:25:50.301 | INFO     | watcher:process_job:134 - [job_bmf_turismo_998] Consultando dados ReceitaWS…
2025-12-18 19:25:50.459 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_998] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_998/serpro/manifest_for_serpro.json
2025-12-18 19:25:52.129 | INFO     | watcher:process_job:140 - [job_bmf_turismo_998] ReceitaWS concluída: OK
2025-12-18 19:25:52.130 | INFO     | watcher:process_job:143 - [job_bmf_turismo_998] Iniciando IA Validador 2 (comparativa)…
2025-12-18 19:25:52.168 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-18 19:26:12.955 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_998 (comparativo)
2025-12-18 19:26:12.956 | INFO     | watcher:process_job:150 - [job_bmf_turismo_998] IA2 concluída: OK
2025-12-18 19:26:12.956 | INFO     | watcher:process_job:153 - [job_bmf_turismo_998] Gerando relatório final…
2025-12-18 19:26:13.050 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_998/resultado
2025-12-18 19:26:13.051 | INFO     | watcher:process_job:155 - [job_bmf_turismo_998] Relatório final gerado.
2025-12-18 19:26:13.093 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_998] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x7e88b1905ee0>
    └ <Thread(ScriptRunner.scriptThread, started 139125505726144)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x7e88b1905bc0>
    └ <Thread(ScriptRunner.scriptThread, started 139125505726144)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 139125505726144)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 139125505726144)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='1d0ab156-e6c1-45df-9f14-f427704a6a99', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 139125505726144)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x7e88b020cfe0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x7e88b02fe8e0>
    └ ScriptRunner(_session_id='1d0ab156-e6c1-45df-9f14-f427704a6a99', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='1d0ab156-e6c1-45df-9f14-f427704a6a99', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x7e88aee4c0e0>
        └ <function exec_func_with_error_handling at 0x7e88b0292840>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x7e88aee4c0e0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x7e88a400e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x7e88970c8680>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x7e8729b77ba0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_998')
    └ <function process_job at 0x7e8729b77b00>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_998'
    └ <function registrar_evento at 0x7e88ad513740>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-18 19:26:13.104 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:22:24.828 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.399 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.439 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.469 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.497 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.498 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2025-12-23 08:22:35.521 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.522 | INFO     | watcher:<module>:20 - watcher.py carregado de: /app/watcher.py
2025-12-23 08:22:35.537 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.551 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:22:35.552 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-23 08:22:35.553 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-23 08:22:35.553 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-23 08:22:35.584 | INFO     | watcher:detect_and_move_jobs:175 - 2 job(s) detectado(s) em /inbox.
2025-12-23 08:22:35.585 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_986] WATCHER
2025-12-23 08:22:35.623 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_986] WATCHER
2025-12-23 08:22:35.630 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_986/manifest.json (exists=True)
2025-12-23 08:22:35.642 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 08:22:35.654 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_986' → 'manifest.normalizado.json'
2025-12-23 08:22:35.654 | INFO     | watcher:process_job:124 - [job_bmf_turismo_986] Iniciando OCR/Docling…
2025-12-23 08:22:35.657 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-23 08:22:35.664 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-23 08:24:52.029 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-23 08:27:57.813 | INFO     | ocr_router:executar_ocr:71 - Roteando fernando_de_lima_vila_nova.pdf para Pipeline Padrão (Docling).
2025-12-23 08:28:31.662 | INFO     | watcher:process_job:126 - [job_bmf_turismo_986] OCR/Docling concluído: OK
2025-12-23 08:28:31.664 | INFO     | watcher:process_job:129 - [job_bmf_turismo_986] Iniciando IA Validador 1…
2025-12-23 08:28:31.682 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 08:28:56.558 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_986 (padrao)
2025-12-23 08:28:56.559 | INFO     | watcher:process_job:131 - [job_bmf_turismo_986] IA1 concluída: OK
2025-12-23 08:28:56.559 | INFO     | watcher:process_job:134 - [job_bmf_turismo_986] Consultando dados ReceitaWS…
2025-12-23 08:28:56.568 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_986] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_986/serpro/manifest_for_serpro.json
2025-12-23 08:28:57.183 | INFO     | consulta_serpro:_mark_manifest_done:67 - [RECEITAWS] Manifesto marcado como done: outbox/job_bmf_turismo_986/serpro/manifest_for_serpro.done.json
2025-12-23 08:28:57.184 | INFO     | watcher:process_job:140 - [job_bmf_turismo_986] ReceitaWS concluída: OK
2025-12-23 08:28:57.184 | INFO     | watcher:process_job:143 - [job_bmf_turismo_986] Iniciando IA Validador 2 (comparativa)…
2025-12-23 08:28:57.193 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 08:29:18.864 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_986 (comparativo)
2025-12-23 08:29:18.865 | INFO     | watcher:process_job:150 - [job_bmf_turismo_986] IA2 concluída: OK
2025-12-23 08:29:18.865 | INFO     | watcher:process_job:153 - [job_bmf_turismo_986] Gerando relatório final…
2025-12-23 08:29:18.888 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_986/resultado
2025-12-23 08:29:18.888 | INFO     | watcher:process_job:155 - [job_bmf_turismo_986] Relatório final gerado.
2025-12-23 08:29:18.894 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_986] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76ccf8f03880>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_986')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_986'
    └ <function registrar_evento at 0x76cd00b2a840>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:29:18.899 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:29:18.899 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_990] WATCHER
2025-12-23 08:29:18.919 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_990] WATCHER
2025-12-23 08:29:18.923 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_990/manifest.json (exists=True)
2025-12-23 08:29:18.931 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 08:29:18.941 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_990' → 'manifest.normalizado.json'
2025-12-23 08:29:18.942 | INFO     | watcher:process_job:124 - [job_bmf_turismo_990] Iniciando OCR/Docling…
2025-12-23 08:29:18.947 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-23 08:29:18.951 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-23 08:29:22.340 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-23 08:32:24.043 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-23 08:32:24.787 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing/job_bmf_turismo_990/fernando_de_lima_vila_nova.pdf
2025-12-23 08:32:25.257 | WARNING  | cnh_ocr:_extract_page_content:184 - Erro no OCR PSM 3: (1, 'Error opening data file /usr/share/tesseract-ocr/5/tessdata/por.traineddata Please make sure the TESSDATA_PREFIX environment variable is set to your "tessdata" directory. Failed loading language \'por\' Tesseract couldn\'t load any languages! Could not initialize tesseract.')
2025-12-23 08:32:25.944 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_990/a3 (OCR_CNH) → OK
2025-12-23 08:32:25.952 | INFO     | watcher:process_job:126 - [job_bmf_turismo_990] OCR/Docling concluído: OK
2025-12-23 08:32:25.952 | INFO     | watcher:process_job:129 - [job_bmf_turismo_990] Iniciando IA Validador 1…
2025-12-23 08:32:25.967 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 08:32:56.402 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_990 (padrao)
2025-12-23 08:32:56.403 | INFO     | watcher:process_job:131 - [job_bmf_turismo_990] IA1 concluída: OK
2025-12-23 08:32:56.404 | INFO     | watcher:process_job:134 - [job_bmf_turismo_990] Consultando dados ReceitaWS…
2025-12-23 08:32:56.410 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_990] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_990/serpro/manifest_for_serpro.json
2025-12-23 08:32:56.728 | INFO     | consulta_serpro:_mark_manifest_done:67 - [RECEITAWS] Manifesto marcado como done: outbox/job_bmf_turismo_990/serpro/manifest_for_serpro.done.json
2025-12-23 08:32:56.729 | INFO     | watcher:process_job:140 - [job_bmf_turismo_990] ReceitaWS concluída: OK
2025-12-23 08:32:56.730 | INFO     | watcher:process_job:143 - [job_bmf_turismo_990] Iniciando IA Validador 2 (comparativa)…
2025-12-23 08:32:56.736 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 08:33:26.684 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_990 (comparativo)
2025-12-23 08:33:26.684 | INFO     | watcher:process_job:150 - [job_bmf_turismo_990] IA2 concluída: OK
2025-12-23 08:33:26.685 | INFO     | watcher:process_job:153 - [job_bmf_turismo_990] Gerando relatório final…
2025-12-23 08:33:26.704 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_990/resultado
2025-12-23 08:33:26.704 | INFO     | watcher:process_job:155 - [job_bmf_turismo_990] Relatório final gerado.
2025-12-23 08:33:26.709 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_990] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76ccf8f03880>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_990')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_990'
    └ <function registrar_evento at 0x76cd00b2a840>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:33:26.715 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:40:58.410 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-23 08:40:58.410 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_985] WATCHER
2025-12-23 08:40:58.429 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_985] WATCHER
2025-12-23 08:40:58.434 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_985/manifest.json (exists=True)
2025-12-23 08:40:58.444 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 08:40:58.458 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_985' → 'manifest.normalizado.json'
2025-12-23 08:40:58.459 | INFO     | watcher:process_job:124 - [job_bmf_turismo_985] Iniciando OCR/Docling…
2025-12-23 08:40:58.461 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-23 08:40:58.466 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-23 08:41:03.170 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-23 08:43:56.702 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-23 08:43:57.433 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing/job_bmf_turismo_985/fernando_de_lima_vila_nova.pdf
2025-12-23 08:43:57.799 | WARNING  | cnh_ocr:_extract_page_content:184 - Erro no OCR PSM 3: (1, 'Error opening data file /usr/share/tesseract-ocr/5/tessdata/por.traineddata Please make sure the TESSDATA_PREFIX environment variable is set to your "tessdata" directory. Failed loading language \'por\' Tesseract couldn\'t load any languages! Could not initialize tesseract.')
2025-12-23 08:43:58.238 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_985/a3 (OCR_CNH) → OK
2025-12-23 08:43:58.246 | INFO     | watcher:process_job:126 - [job_bmf_turismo_985] OCR/Docling concluído: OK
2025-12-23 08:43:58.246 | INFO     | watcher:process_job:129 - [job_bmf_turismo_985] Iniciando IA Validador 1…
2025-12-23 08:43:58.259 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 08:44:18.963 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_985 (padrao)
2025-12-23 08:44:18.963 | INFO     | watcher:process_job:131 - [job_bmf_turismo_985] IA1 concluída: OK
2025-12-23 08:44:18.963 | INFO     | watcher:process_job:134 - [job_bmf_turismo_985] Consultando dados ReceitaWS…
2025-12-23 08:44:18.969 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_985] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_985/serpro/manifest_for_serpro.json
2025-12-23 08:44:19.399 | INFO     | consulta_serpro:_mark_manifest_done:67 - [RECEITAWS] Manifesto marcado como done: outbox/job_bmf_turismo_985/serpro/manifest_for_serpro.done.json
2025-12-23 08:44:19.400 | INFO     | watcher:process_job:140 - [job_bmf_turismo_985] ReceitaWS concluída: OK
2025-12-23 08:44:19.400 | INFO     | watcher:process_job:143 - [job_bmf_turismo_985] Iniciando IA Validador 2 (comparativa)…
2025-12-23 08:44:19.406 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 08:44:41.261 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_985 (comparativo)
2025-12-23 08:44:41.261 | INFO     | watcher:process_job:150 - [job_bmf_turismo_985] IA2 concluída: OK
2025-12-23 08:44:41.262 | INFO     | watcher:process_job:153 - [job_bmf_turismo_985] Gerando relatório final…
2025-12-23 08:44:41.283 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_985/resultado
2025-12-23 08:44:41.283 | INFO     | watcher:process_job:155 - [job_bmf_turismo_985] Relatório final gerado.
2025-12-23 08:44:41.288 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_985] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76ccf8f03880>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_985')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_985'
    └ <function registrar_evento at 0x76cd00b2a840>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:44:41.293 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 08:54:02.966 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-23 08:54:02.967 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_984] WATCHER
2025-12-23 08:54:02.987 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_984] WATCHER
2025-12-23 08:54:02.993 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_984/manifest.json (exists=True)
2025-12-23 08:54:03.004 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 08:54:03.022 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_984] Erro durante o processamento do job: Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76ccf8f03880>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_984')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ PosixPath('processing/job_bmf_turismo_984')
              │         │      └ <function load_manifest at 0x76ccf8d57ce0>
              │         └ typing.Any
              └ typing.Dict

  File "/app/manifest_loader.py", line 250, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']"

RuntimeError: Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']
2025-12-23 08:54:03.052 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']
2025-12-23 08:57:07.255 | INFO     | log_service:init_folders:119 - Estrutura de diretórios inicializada com sucesso.
2025-12-23 08:57:07.256 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2025-12-23 08:57:07.256 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2025-12-23 08:57:07.257 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2025-12-23 08:57:42.381 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-23 08:57:42.382 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_984] WATCHER
2025-12-23 08:57:42.401 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_984] WATCHER
2025-12-23 08:57:42.407 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_984/manifest.json (exists=True)
2025-12-23 08:57:42.416 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 08:57:42.423 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_984] Erro durante o processamento do job: Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='79b79e69-c64c-46fa-b816-e57824fff059', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='79b79e69-c64c-46fa-b816-e57824fff059', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='79b79e69-c64c-46fa-b816-e57824fff059', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cb33656480>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cb33656480>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76cd015344a0>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_984')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ PosixPath('processing/job_bmf_turismo_984')
              │         │      └ <function load_manifest at 0x76ccf8d57ce0>
              │         └ typing.Any
              └ typing.Dict

  File "/app/manifest_loader.py", line 250, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']"

RuntimeError: Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']
2025-12-23 08:57:42.442 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: Arquivos listados no manifest não encontrados: ['fernando_de_lima_vila_nova.pdf']
2025-12-23 09:00:44.227 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-23 09:00:44.228 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_984] WATCHER
2025-12-23 09:00:44.248 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_984] WATCHER
2025-12-23 09:00:44.253 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_984/manifest.json (exists=True)
2025-12-23 09:00:44.262 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 09:00:44.274 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_984' → 'manifest.normalizado.json'
2025-12-23 09:00:44.274 | WARNING  | watcher:process_job:121 - [job_bmf_turismo_984] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2025-12-23 09:00:44.275 | INFO     | watcher:process_job:124 - [job_bmf_turismo_984] Iniciando OCR/Docling…
2025-12-23 09:00:44.277 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-23 09:00:44.282 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-23 09:00:50.159 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-23 09:03:53.016 | INFO     | ocr_router:executar_ocr:50 - Roteando fernando_de_lima_vila_nova_cnh.pdf para CNH OCR.
2025-12-23 09:03:53.997 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing/job_bmf_turismo_984/fernando_de_lima_vila_nova_cnh.pdf
2025-12-23 09:03:54.617 | WARNING  | cnh_ocr:_extract_page_content:184 - Erro no OCR PSM 3: (1, 'Error opening data file /usr/share/tesseract-ocr/5/tessdata/por.traineddata Please make sure the TESSDATA_PREFIX environment variable is set to your "tessdata" directory. Failed loading language \'por\' Tesseract couldn\'t load any languages! Could not initialize tesseract.')
2025-12-23 09:03:55.291 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_984/a3 (OCR_CNH) → OK
2025-12-23 09:03:55.300 | INFO     | watcher:process_job:126 - [job_bmf_turismo_984] OCR/Docling concluído: OK
2025-12-23 09:03:55.300 | INFO     | watcher:process_job:129 - [job_bmf_turismo_984] Iniciando IA Validador 1…
2025-12-23 09:03:55.315 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 09:04:33.478 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_984 (padrao)
2025-12-23 09:04:33.478 | INFO     | watcher:process_job:131 - [job_bmf_turismo_984] IA1 concluída: OK
2025-12-23 09:04:33.479 | INFO     | watcher:process_job:134 - [job_bmf_turismo_984] Consultando dados ReceitaWS…
2025-12-23 09:04:33.488 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_984] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_984/serpro/manifest_for_serpro.json
2025-12-23 09:04:34.092 | INFO     | watcher:process_job:140 - [job_bmf_turismo_984] ReceitaWS concluída: OK
2025-12-23 09:04:34.093 | INFO     | watcher:process_job:143 - [job_bmf_turismo_984] Iniciando IA Validador 2 (comparativa)…
2025-12-23 09:04:34.102 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 09:05:06.974 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_984 (comparativo)
2025-12-23 09:05:06.974 | INFO     | watcher:process_job:150 - [job_bmf_turismo_984] IA2 concluída: OK
2025-12-23 09:05:06.974 | INFO     | watcher:process_job:153 - [job_bmf_turismo_984] Gerando relatório final…
2025-12-23 09:05:07.004 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_984/resultado
2025-12-23 09:05:07.005 | INFO     | watcher:process_job:155 - [job_bmf_turismo_984] Relatório final gerado.
2025-12-23 09:05:07.013 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_984] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130622773262016)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='eca8bdbe-d890-4ace-84eb-41cce418bce0', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cd00b73600>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76ccf8f03880>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_984')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_984'
    └ <function registrar_evento at 0x76cd00b2a840>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 09:05:07.024 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 09:05:43.955 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-23 09:05:43.956 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_983] WATCHER
2025-12-23 09:05:43.986 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_983] WATCHER
2025-12-23 09:05:43.992 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_983/manifest.json (exists=True)
2025-12-23 09:05:44.001 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 09:05:44.014 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_983] Erro durante o processamento do job: Arquivos listados no manifest não encontrados: ['cnh_fernando_de_lima_vila_nova.pdf']
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='79b79e69-c64c-46fa-b816-e57824fff059', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='79b79e69-c64c-46fa-b816-e57824fff059', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='79b79e69-c64c-46fa-b816-e57824fff059', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cb33656480>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cb33656480>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76cd015344a0>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_983')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 117, in process_job
    manifest: Dict[str, Any] = load_manifest(processing_dir, strict_files=True)
              │         │      │             └ PosixPath('processing/job_bmf_turismo_983')
              │         │      └ <function load_manifest at 0x76ccf8d57ce0>
              │         └ typing.Any
              └ typing.Dict

  File "/app/manifest_loader.py", line 250, in load_manifest
    raise RuntimeError(msg)
                       └ "Arquivos listados no manifest não encontrados: ['cnh_fernando_de_lima_vila_nova.pdf']"

RuntimeError: Arquivos listados no manifest não encontrados: ['cnh_fernando_de_lima_vila_nova.pdf']
2025-12-23 09:05:44.025 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: Arquivos listados no manifest não encontrados: ['cnh_fernando_de_lima_vila_nova.pdf']
2025-12-23 09:09:29.767 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2025-12-23 09:09:29.768 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_983] WATCHER
2025-12-23 09:09:29.801 | INFO     | log_service:registrar_evento:164 - [job_bmf_turismo_983] WATCHER
2025-12-23 09:09:29.807 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing/job_bmf_turismo_983/manifest.json (exists=True)
2025-12-23 09:09:29.819 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2025-12-23 09:09:29.833 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/job_bmf_turismo_983' → 'manifest.normalizado.json'
2025-12-23 09:09:29.834 | INFO     | watcher:process_job:124 - [job_bmf_turismo_983] Iniciando OCR/Docling…
2025-12-23 09:09:29.838 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2025-12-23 09:09:29.845 | INFO     | ocr_router:executar_ocr:71 - Roteando cartao_cnpj.pdf para Pipeline Padrão (Docling).
2025-12-23 09:09:36.158 | INFO     | ocr_router:executar_ocr:71 - Roteando ii_alteracao_contratual_bmf_turismo.pdf para Pipeline Padrão (Docling).
2025-12-23 09:12:35.392 | INFO     | ocr_router:executar_ocr:50 - Roteando cnh_fernando_de_lima_vila_nova.pdf para CNH OCR.
2025-12-23 09:12:36.247 | INFO     | cnh_ocr:process_cnh:75 - Processando página 1 de processing/job_bmf_turismo_983/cnh_fernando_de_lima_vila_nova.pdf
2025-12-23 09:12:36.665 | WARNING  | cnh_ocr:_extract_page_content:184 - Erro no OCR PSM 3: (1, 'Error opening data file /usr/share/tesseract-ocr/5/tessdata/por.traineddata Please make sure the TESSDATA_PREFIX environment variable is set to your "tessdata" directory. Failed loading language \'por\' Tesseract couldn\'t load any languages! Could not initialize tesseract.')
2025-12-23 09:12:37.146 | INFO     | ledger:register_entry:68 - Ledger atualizado: job_bmf_turismo_983/a3 (OCR_CNH) → OK
2025-12-23 09:12:37.160 | INFO     | watcher:process_job:126 - [job_bmf_turismo_983] OCR/Docling concluído: OK
2025-12-23 09:12:37.160 | INFO     | watcher:process_job:129 - [job_bmf_turismo_983] Iniciando IA Validador 1…
2025-12-23 09:12:37.173 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 09:13:06.101 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_983 (padrao)
2025-12-23 09:13:06.102 | INFO     | watcher:process_job:131 - [job_bmf_turismo_983] IA1 concluída: OK
2025-12-23 09:13:06.102 | INFO     | watcher:process_job:134 - [job_bmf_turismo_983] Consultando dados ReceitaWS…
2025-12-23 09:13:06.110 | INFO     | watcher:_stage_manifest_for_serpro:92 - [job_bmf_turismo_983] Manifest staged para ReceitaWS: outbox/job_bmf_turismo_983/serpro/manifest_for_serpro.json
2025-12-23 09:13:06.425 | INFO     | consulta_serpro:_mark_manifest_done:67 - [RECEITAWS] Manifesto marcado como done: outbox/job_bmf_turismo_983/serpro/manifest_for_serpro.done.json
2025-12-23 09:13:06.426 | INFO     | watcher:process_job:140 - [job_bmf_turismo_983] ReceitaWS concluída: OK
2025-12-23 09:13:06.426 | INFO     | watcher:process_job:143 - [job_bmf_turismo_983] Iniciando IA Validador 2 (comparativa)…
2025-12-23 09:13:06.432 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2025-12-23 09:13:42.715 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para job_bmf_turismo_983 (comparativo)
2025-12-23 09:13:42.715 | INFO     | watcher:process_job:150 - [job_bmf_turismo_983] IA2 concluída: OK
2025-12-23 09:13:42.715 | INFO     | watcher:process_job:153 - [job_bmf_turismo_983] Gerando relatório final…
2025-12-23 09:13:42.743 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox/job_bmf_turismo_983/resultado
2025-12-23 09:13:42.744 | INFO     | watcher:process_job:155 - [job_bmf_turismo_983] Relatório final gerado.
2025-12-23 09:13:42.750 | ERROR    | watcher:process_job:162 - [job_bmf_turismo_983] Erro durante o processamento do job: registrar_evento() got multiple values for argument 'nivel'
Traceback (most recent call last):

  File "/usr/local/lib/python3.11/threading.py", line 1002, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x76cd035e1ee0>
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/threading.py", line 1045, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x76cd035e1bc0>
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/threading.py", line 982, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='79b79e69-c64c-46fa-b816-e57824fff059', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 130615089809088)>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x76cd01ef1120>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x76cd01de68e0>
    └ ScriptRunner(_session_id='79b79e69-c64c-46fa-b816-e57824fff059', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='79b79e69-c64c-46fa-b816-e57824fff059', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cb33656480>
        └ <function exec_func_with_error_handling at 0x76cd01f767a0>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x76cb33656480>
  File "/usr/local/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x76ccf000e760, file "/app/main.py", line 1>

  File "/app/main.py", line 158, in <module>
    main()
    └ <function main at 0x76cd015344a0>

  File "/app/main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x76cb7b7b47c0>

  File "/app/watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ PosixPath('inbox/job_bmf_turismo_983')
    └ <function process_job at 0x76cb7b7b4720>

> File "/app/watcher.py", line 159, in process_job
    registrar_evento(job_id, "WATCHER", "Pipeline concluído com sucesso", nivel="info")
    │                └ 'job_bmf_turismo_983'
    └ <function registrar_evento at 0x76cd00b2a840>

TypeError: registrar_evento() got multiple values for argument 'nivel'
2025-12-23 09:13:42.774 | INFO     | log_service:registrar_evento:164 - [WATCHER] Pipeline falhou: registrar_evento() got multiple values for argument 'nivel'
2026-01-12 20:23:02.758 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.246 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.250 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.264 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.278 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.278 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-12 20:24:05.292 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.293 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-12 20:24:05.297 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.302 | INFO     | log_service:init_folders:141 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-12 20:24:05.302 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-12 20:24:05.304 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-12 20:24:05.305 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-12 20:24:05.307 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2026-01-12 20:24:05.308 | INFO     | log_service:registrar_evento:186 - [WATCHER] Novo job detectado em inbox: inbox/36194-2026-01-12-18-25-00
2026-01-12 20:24:05.313 | INFO     | log_service:registrar_evento:186 - [WATCHER] Job movido para processing: processing/36194-2026-01-12-18-25-00
2026-01-12 20:24:05.315 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\36194-2026-01-12-18-25-00\manifest.json (exists=True)
2026-01-12 20:24:05.318 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2026-01-12 20:24:05.322 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/36194-2026-01-12-18-25-00' → 'manifest.normalizado.json'
2026-01-12 20:24:05.324 | WARNING  | watcher:process_job:121 - [36194-2026-01-12-18-25-00] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2026-01-12 20:24:05.325 | INFO     | watcher:process_job:124 - [36194-2026-01-12-18-25-00] Iniciando OCR/Docling…
2026-01-12 20:24:05.327 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2026-01-12 20:24:05.329 | INFO     | ocr_router:executar_ocr:71 - Roteando cnpj_cadi.pdf para Pipeline Padrão (Docling).
2026-01-12 20:24:28.529 | INFO     | ocr_router:executar_ocr:71 - Roteando alteracao_contratual_cadi.pdf para Pipeline Padrão (Docling).
2026-01-12 20:31:22.839 | INFO     | ocr_router:executar_ocr:71 - Roteando rg_camila.pdf para Pipeline Padrão (Docling).
2026-01-12 20:32:58.308 | INFO     | watcher:process_job:126 - [36194-2026-01-12-18-25-00] OCR/Docling concluído: OK
2026-01-12 20:32:58.323 | INFO     | watcher:process_job:129 - [36194-2026-01-12-18-25-00] Iniciando IA Validador 1…
2026-01-12 20:32:58.355 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-12 20:33:03.261 | ERROR    | doc_verifier_agent:validar_documentos_openai:113 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001895B842340>
    └ <Thread(ScriptRunner.scriptThread, started 28576)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001895B8420C0>
    └ <Thread(ScriptRunner.scriptThread, started 28576)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 28576)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 28576)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='51e81f02-202d-4dca-bdec-6996426d35d2', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 28576)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001895E0C2B60>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001895ECB45E0>
    └ ScriptRunner(_session_id='51e81f02-202d-4dca-bdec-6996426d35d2', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='51e81f02-202d-4dca-bdec-6996426d35d2', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001895F510040>
        └ <function exec_func_with_error_handling at 0x000001895EC2F740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001895F510040>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001895D5C1240, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001896163DC60>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000189114D3240>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/36194-2026-01-12-18-25-00')
    └ <function process_job at 0x00000189114D31A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 130, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result.get("dados_extraidos", ""), manifest, modo="padrao")
                 │                         │       │          │                           └ {'job_id': '36194-2026-01-07-14-36-53', 'fornecedor_id': '20594257000126', 'perfil_validacao': 'PJ', 'contexto': {'razao_soci...
                 │                         │       │          └ <method 'get' of 'dict' objects>
                 │                         │       └ {'status': 'OK', 'job_id': '36194-2026-01-12-18-25-00', 'evidencias_dir': 'evidencias\\ocr\\36194-2026-01-12-18-25-00', 'dado...
                 │                         └ '36194-2026-01-12-18-25-00'
                 └ <function validar_documentos_openai at 0x00000189114D2020>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 68, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000018913284400>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000189126DF620>
                 │      └ <openai.resources.chat.chat.Chat object at 0x00000189126DFA10>
                 └ <openai.OpenAI object at 0x0000018912E8DD30>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-4o-mini', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000189126DF620>,)
           └ <function Completions.create at 0x00000189132842C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000018912E8DD30>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000189126DF620>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000189614CB560>
           │    │          └ <openai.OpenAI object at 0x0000018912E8DD30>
           │    └ ~ResponseT
           └ <function cast at 0x000001895B8993A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000189614C9D00>
          └ <openai.OpenAI object at 0x0000018912E8DD30>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
2026-01-12 20:33:03.314 | INFO     | watcher:process_job:131 - [36194-2026-01-12-18-25-00] IA1 concluída: ERRO
2026-01-12 20:33:03.315 | INFO     | watcher:process_job:134 - [36194-2026-01-12-18-25-00] Consultando dados ReceitaWS…
2026-01-12 20:33:03.320 | INFO     | watcher:_stage_manifest_for_serpro:92 - [36194-2026-01-12-18-25-00] Manifest staged para ReceitaWS: outbox/36194-2026-01-12-18-25-00/serpro/manifest_for_serpro.json
2026-01-12 20:33:06.273 | INFO     | watcher:process_job:140 - [36194-2026-01-12-18-25-00] ReceitaWS concluída: OK
2026-01-12 20:33:06.277 | INFO     | watcher:process_job:143 - [36194-2026-01-12-18-25-00] Iniciando IA Validador 2 (comparativa)…
2026-01-12 20:33:06.281 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-12 20:33:08.021 | ERROR    | doc_verifier_agent:validar_documentos_openai:113 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001895B842340>
    └ <Thread(ScriptRunner.scriptThread, started 28576)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001895B8420C0>
    └ <Thread(ScriptRunner.scriptThread, started 28576)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 28576)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 28576)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='51e81f02-202d-4dca-bdec-6996426d35d2', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 28576)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001895E0C2B60>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001895ECB45E0>
    └ ScriptRunner(_session_id='51e81f02-202d-4dca-bdec-6996426d35d2', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='51e81f02-202d-4dca-bdec-6996426d35d2', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001895F510040>
        └ <function exec_func_with_error_handling at 0x000001895EC2F740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001895F510040>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001895D5C1240, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001896163DC60>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000189114D3240>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/36194-2026-01-12-18-25-00')
    └ <function process_job at 0x00000189114D31A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 149, in process_job
    ia2_result = validar_documentos_openai(job_id, json.dumps(entrada_ia2, ensure_ascii=False), manifest, modo="comparativo")
                 │                         │       │    │     │                                 └ {'job_id': '36194-2026-01-07-14-36-53', 'fornecedor_id': '20594257000126', 'perfil_validacao': 'PJ', 'contexto': {'razao_soci...
                 │                         │       │    │     └ {'dados_ocr': '\n\n# cnpj_cadi.pdf (Tesseract)\n\n\n--- Página 1 ---\n06/01/26, 16:13 about:blank\nsólo REPUBLICA FEDERATIVA ...
                 │                         │       │    └ <function dumps at 0x000001895B89E8E0>
                 │                         │       └ <module 'json' from 'C:\\Python313\\Lib\\json\\__init__.py'>
                 │                         └ '36194-2026-01-12-18-25-00'
                 └ <function validar_documentos_openai at 0x00000189114D2020>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 68, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000018913284400>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x0000018914F1EE90>
                 │      └ <openai.resources.chat.chat.Chat object at 0x0000018914F1EFD0>
                 └ <openai.OpenAI object at 0x0000018914F1D950>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-4o-mini', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x0000018914F1EE90>,)
           └ <function Completions.create at 0x00000189132842C0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x0000018914F1D950>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x0000018914F1EE90>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000189614CB560>
           │    │          └ <openai.OpenAI object at 0x0000018914F1D950>
           │    └ ~ResponseT
           └ <function cast at 0x000001895B8993A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000189614C9D00>
          └ <openai.OpenAI object at 0x0000018914F1D950>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
2026-01-12 20:33:08.034 | INFO     | watcher:process_job:150 - [36194-2026-01-12-18-25-00] IA2 concluída: ERRO
2026-01-12 20:33:08.035 | INFO     | watcher:process_job:153 - [36194-2026-01-12-18-25-00] Gerando relatório final…
2026-01-12 20:33:08.051 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\36194-2026-01-12-18-25-00\resultado
2026-01-12 20:33:08.052 | INFO     | watcher:process_job:155 - [36194-2026-01-12-18-25-00] Relatório final gerado.
2026-01-12 20:33:08.058 | INFO     | log_service:registrar_evento:186 - [WATCHER] Pipeline concluído com sucesso
2026-01-13 08:17:44.578 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.283 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.301 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.326 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.348 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.349 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 08:18:20.371 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.373 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 08:18:20.390 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.399 | ERROR    | log_service:safe_mkdir:71 - ERRO DE PERMISSÃO EM C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2: O sistema não consegue escrever nesta pasta. Verifique se o Windows ou OneDrive está bloqueando o acesso. Erro: [WinError 32] O arquivo já está sendo usado por outro processo: 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2\\.perm_test_24276'
2026-01-13 08:18:20.445 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:18:20.451 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 08:18:20.639 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 08:18:20.656 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 08:18:20.781 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2026-01-13 08:18:20.782 | INFO     | log_service:registrar_evento:203 - [WATCHER] Novo job detectado em inbox: inbox/36194-2026-01-13-08-15-00
2026-01-13 08:18:20.791 | INFO     | log_service:registrar_evento:203 - [WATCHER] Job movido para processing: processing/36194-2026-01-13-08-15-00
2026-01-13 08:18:20.794 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\36194-2026-01-13-08-15-00\manifest.json (exists=True)
2026-01-13 08:18:20.801 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2026-01-13 08:18:20.807 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/36194-2026-01-13-08-15-00' → 'manifest.normalizado.json'
2026-01-13 08:18:20.811 | WARNING  | watcher:process_job:121 - [36194-2026-01-13-08-15-00] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2026-01-13 08:18:20.813 | INFO     | watcher:process_job:124 - [36194-2026-01-13-08-15-00] Iniciando OCR/Docling…
2026-01-13 08:18:21.157 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2026-01-13 08:18:21.163 | INFO     | ocr_router:executar_ocr:71 - Roteando cnpj_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 08:18:34.331 | INFO     | ocr_router:executar_ocr:71 - Roteando alteracao_contratual_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 08:24:34.417 | INFO     | ocr_router:executar_ocr:71 - Roteando rg_camila.pdf para Pipeline Padrão (Docling).
2026-01-13 08:25:47.908 | INFO     | watcher:process_job:126 - [36194-2026-01-13-08-15-00] OCR/Docling concluído: OK
2026-01-13 08:25:47.909 | INFO     | watcher:process_job:129 - [36194-2026-01-13-08-15-00] Iniciando IA Validador 1…
2026-01-13 08:25:47.915 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 08:25:50.576 | ERROR    | doc_verifier_agent:validar_documentos_openai:113 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001A32C262340>
    └ <Thread(ScriptRunner.scriptThread, started 8488)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001A32C2620C0>
    └ <Thread(ScriptRunner.scriptThread, started 8488)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 8488)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 8488)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='ef59fa47-1c02-48ae-8b83-a58c5fe29a5e', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 8488)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001A32EB72E30>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001A32F7645E0>
    └ ScriptRunner(_session_id='ef59fa47-1c02-48ae-8b83-a58c5fe29a5e', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='ef59fa47-1c02-48ae-8b83-a58c5fe29a5e', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A32FFB40E0>
        └ <function exec_func_with_error_handling at 0x000001A32F6DF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A32FFB40E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001A32E09DB10, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001A361DDC680>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001A361DDC5E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/36194-2026-01-13-08-15-00')
    └ <function process_job at 0x000001A361DDC540>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 130, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result.get("dados_extraidos", ""), manifest, modo="padrao")
                 │                         │       │          │                           └ {'job_id': '36194-2026-01-07-14-36-53', 'fornecedor_id': '20594257000126', 'perfil_validacao': 'PJ', 'contexto': {'razao_soci...
                 │                         │       │          └ <method 'get' of 'dict' objects>
                 │                         │       └ {'status': 'OK', 'job_id': '36194-2026-01-13-08-15-00', 'evidencias_dir': 'evidencias\\ocr\\36194-2026-01-13-08-15-00', 'dado...
                 │                         └ '36194-2026-01-13-08-15-00'
                 └ <function validar_documentos_openai at 0x000001A361DABD80>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 68, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x000001A305C14D60>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001A3632D3230>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000001A3632D3620>
                 └ <openai.OpenAI object at 0x000001A363A682F0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-4o-mini', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001A3632D3230>,)
           └ <function Completions.create at 0x000001A305C14E00>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001A363A682F0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001A3632D3230>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001A331EFF740>
           │    │          └ <openai.OpenAI object at 0x000001A363A682F0>
           │    └ ~ResponseT
           └ <function cast at 0x000001A32C2B93A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001A331EFDEE0>
          └ <openai.OpenAI object at 0x000001A363A682F0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
2026-01-13 08:25:50.617 | INFO     | watcher:process_job:131 - [36194-2026-01-13-08-15-00] IA1 concluída: ERRO
2026-01-13 08:25:50.618 | INFO     | watcher:process_job:134 - [36194-2026-01-13-08-15-00] Consultando dados ReceitaWS…
2026-01-13 08:25:50.625 | INFO     | watcher:_stage_manifest_for_serpro:92 - [36194-2026-01-13-08-15-00] Manifest staged para ReceitaWS: outbox/36194-2026-01-13-08-15-00/serpro/manifest_for_serpro.json
2026-01-13 08:25:52.875 | INFO     | watcher:process_job:140 - [36194-2026-01-13-08-15-00] ReceitaWS concluída: OK
2026-01-13 08:25:52.877 | INFO     | watcher:process_job:143 - [36194-2026-01-13-08-15-00] Iniciando IA Validador 2 (comparativa)…
2026-01-13 08:25:52.883 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 08:25:54.468 | ERROR    | doc_verifier_agent:validar_documentos_openai:113 - Erro ao validar via OpenAI: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000001A32C262340>
    └ <Thread(ScriptRunner.scriptThread, started 8488)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000001A32C2620C0>
    └ <Thread(ScriptRunner.scriptThread, started 8488)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 8488)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 8488)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='ef59fa47-1c02-48ae-8b83-a58c5fe29a5e', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 8488)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000001A32EB72E30>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x000001A32F7645E0>
    └ ScriptRunner(_session_id='ef59fa47-1c02-48ae-8b83-a58c5fe29a5e', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='ef59fa47-1c02-48ae-8b83-a58c5fe29a5e', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A32FFB40E0>
        └ <function exec_func_with_error_handling at 0x000001A32F6DF740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000001A32FFB40E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x000001A32E09DB10, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x000001A361DDC680>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x000001A361DDC5E0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/36194-2026-01-13-08-15-00')
    └ <function process_job at 0x000001A361DDC540>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 149, in process_job
    ia2_result = validar_documentos_openai(job_id, json.dumps(entrada_ia2, ensure_ascii=False), manifest, modo="comparativo")
                 │                         │       │    │     │                                 └ {'job_id': '36194-2026-01-07-14-36-53', 'fornecedor_id': '20594257000126', 'perfil_validacao': 'PJ', 'contexto': {'razao_soci...
                 │                         │       │    │     └ {'dados_ocr': '\n\n# cnpj_cadi.pdf (Tesseract)\n\n\n--- Página 1 ---\n06/01/26, 16:13 about:blank\nsólo REPUBLICA FEDERATIVA ...
                 │                         │       │    └ <function dumps at 0x000001A32C2BE8E0>
                 │                         │       └ <module 'json' from 'C:\\Python313\\Lib\\json\\__init__.py'>
                 │                         └ '36194-2026-01-13-08-15-00'
                 └ <function validar_documentos_openai at 0x000001A361DABD80>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 68, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x000001A305C14D60>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000001A363687890>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000001A363687C50>
                 └ <openai.OpenAI object at 0x000001A3639B07D0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-4o-mini', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentaç...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000001A363687890>,)
           └ <function Completions.create at 0x000001A305C14E00>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000001A3639B07D0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000001A363687890>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x000001A331EFF740>
           │    │          └ <openai.OpenAI object at 0x000001A3639B07D0>
           │    └ ~ResponseT
           └ <function cast at 0x000001A32C2B93A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x000001A331EFDEE0>
          └ <openai.OpenAI object at 0x000001A3639B07D0>

openai.AuthenticationError: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-proj-********************************************************************************************************************************************************iRkA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'code': 'invalid_api_key', 'param': None}, 'status': 401}
2026-01-13 08:25:54.480 | INFO     | watcher:process_job:150 - [36194-2026-01-13-08-15-00] IA2 concluída: ERRO
2026-01-13 08:25:54.480 | INFO     | watcher:process_job:153 - [36194-2026-01-13-08-15-00] Gerando relatório final…
2026-01-13 08:25:54.491 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\36194-2026-01-13-08-15-00\resultado
2026-01-13 08:25:54.492 | INFO     | watcher:process_job:155 - [36194-2026-01-13-08-15-00] Relatório final gerado.
2026-01-13 08:25:54.497 | INFO     | log_service:registrar_evento:203 - [WATCHER] Pipeline concluído com sucesso
2026-01-13 08:36:38.708 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.097 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.107 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.115 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.126 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.126 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 08:36:48.135 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.135 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 08:36:48.144 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.153 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:36:48.154 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 08:36:48.155 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 08:36:48.155 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 08:37:40.112 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.566 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.579 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.596 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.610 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.610 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 08:37:48.623 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.624 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 08:37:48.635 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.642 | ERROR    | log_service:safe_mkdir:71 - ERRO DE PERMISSÃO EM C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2: O sistema não consegue escrever nesta pasta. Verifique se o Windows ou OneDrive está bloqueando o acesso. Erro: [WinError 2] O sistema não pode encontrar o arquivo especificado: 'C:\\Users\\walte\\OneDrive\\Workspace\\IA\\LICITANET\\Projeto_Valida\\Licitanet_OCR_OpenAI_V2\\.perm_test_13580'
2026-01-13 08:37:48.669 | INFO     | log_service:init_folders:158 - Estrutura de diretórios inicializada com sucesso (com permissões 777).
2026-01-13 08:37:48.670 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 08:37:48.673 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 08:37:48.673 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 08:41:48.185 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.167 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.180 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.192 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.206 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.207 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 08:41:58.219 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.220 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 08:41:58.232 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.246 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 08:41:58.247 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 08:41:58.248 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 08:41:58.249 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 08:43:23.278 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2026-01-13 08:43:23.279 | INFO     | log_service:registrar_evento:205 - [WATCHER] Novo job detectado em inbox: inbox/36194-2026-01-13-08-45-00
2026-01-13 08:43:23.285 | INFO     | log_service:registrar_evento:205 - [WATCHER] Job movido para processing: processing/36194-2026-01-13-08-45-00
2026-01-13 08:43:23.286 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\36194-2026-01-13-08-45-00\manifest.json (exists=True)
2026-01-13 08:43:23.289 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2026-01-13 08:43:23.292 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/36194-2026-01-13-08-45-00' → 'manifest.normalizado.json'
2026-01-13 08:43:23.293 | WARNING  | watcher:process_job:121 - [36194-2026-01-13-08-45-00] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2026-01-13 08:43:23.294 | INFO     | watcher:process_job:124 - [36194-2026-01-13-08-45-00] Iniciando OCR/Docling…
2026-01-13 08:43:23.297 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2026-01-13 08:43:23.298 | INFO     | ocr_router:executar_ocr:71 - Roteando cnpj_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 08:43:30.991 | INFO     | ocr_router:executar_ocr:71 - Roteando alteracao_contratual_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 08:48:26.016 | INFO     | ocr_router:executar_ocr:71 - Roteando rg_camila.pdf para Pipeline Padrão (Docling).
2026-01-13 08:49:28.711 | INFO     | watcher:process_job:126 - [36194-2026-01-13-08-45-00] OCR/Docling concluído: OK
2026-01-13 08:49:28.712 | INFO     | watcher:process_job:129 - [36194-2026-01-13-08-45-00] Iniciando IA Validador 1…
2026-01-13 08:49:28.717 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 08:49:54.861 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para 36194-2026-01-13-08-45-00 (padrao)
2026-01-13 08:49:54.861 | INFO     | watcher:process_job:131 - [36194-2026-01-13-08-45-00] IA1 concluída: OK
2026-01-13 08:49:54.862 | INFO     | watcher:process_job:134 - [36194-2026-01-13-08-45-00] Consultando dados ReceitaWS…
2026-01-13 08:49:54.865 | INFO     | watcher:_stage_manifest_for_serpro:92 - [36194-2026-01-13-08-45-00] Manifest staged para ReceitaWS: outbox/36194-2026-01-13-08-45-00/serpro/manifest_for_serpro.json
2026-01-13 08:49:55.729 | INFO     | watcher:process_job:140 - [36194-2026-01-13-08-45-00] ReceitaWS concluída: OK
2026-01-13 08:49:55.729 | INFO     | watcher:process_job:143 - [36194-2026-01-13-08-45-00] Iniciando IA Validador 2 (comparativa)…
2026-01-13 08:49:55.733 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 08:50:22.083 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para 36194-2026-01-13-08-45-00 (comparativo)
2026-01-13 08:50:22.084 | INFO     | watcher:process_job:150 - [36194-2026-01-13-08-45-00] IA2 concluída: OK
2026-01-13 08:50:22.084 | INFO     | watcher:process_job:153 - [36194-2026-01-13-08-45-00] Gerando relatório final…
2026-01-13 08:50:22.092 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\36194-2026-01-13-08-45-00\resultado
2026-01-13 08:50:22.093 | INFO     | watcher:process_job:155 - [36194-2026-01-13-08-45-00] Relatório final gerado.
2026-01-13 08:50:22.094 | INFO     | log_service:registrar_evento:205 - [WATCHER] Pipeline concluído com sucesso
2026-01-13 10:23:18.823 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.845 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.853 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.863 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.870 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.871 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 10:23:28.878 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.878 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 10:23:28.885 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.893 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:23:28.894 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 10:23:28.895 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 10:23:28.895 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 10:24:29.881 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.526 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.538 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.550 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.564 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.564 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 10:24:37.579 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.580 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 10:24:37.593 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.612 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.613 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 10:24:37.615 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:24:37.615 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 10:24:37.617 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 10:24:37.618 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 10:24:37.620 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 10:24:37.621 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 10:24:57.630 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2026-01-13 10:24:57.631 | INFO     | log_service:registrar_evento:205 - [WATCHER] Novo job detectado em inbox: inbox/36194-2026-01-13-10-22-00
2026-01-13 10:24:57.633 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2026-01-13 10:24:57.633 | INFO     | log_service:registrar_evento:205 - [WATCHER] Novo job detectado em inbox: inbox/36194-2026-01-13-10-22-00
2026-01-13 10:24:57.640 | INFO     | log_service:registrar_evento:205 - [WATCHER] Job movido para processing: processing/36194-2026-01-13-10-22-00
2026-01-13 10:24:57.641 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\36194-2026-01-13-10-22-00\manifest.json (exists=True)
2026-01-13 10:24:57.646 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2026-01-13 10:24:57.650 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/36194-2026-01-13-10-22-00' → 'manifest.normalizado.json'
2026-01-13 10:24:57.651 | WARNING  | watcher:process_job:121 - [36194-2026-01-13-10-22-00] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2026-01-13 10:24:57.651 | INFO     | watcher:process_job:124 - [36194-2026-01-13-10-22-00] Iniciando OCR/Docling…
2026-01-13 10:24:57.662 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2026-01-13 10:24:57.665 | INFO     | ocr_router:executar_ocr:71 - Roteando cnpj_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 10:25:10.337 | INFO     | ocr_router:executar_ocr:71 - Roteando alteracao_contratual_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 10:30:41.170 | INFO     | ocr_router:executar_ocr:71 - Roteando rg_camila.pdf para Pipeline Padrão (Docling).
2026-01-13 10:31:42.063 | INFO     | watcher:process_job:126 - [36194-2026-01-13-10-22-00] OCR/Docling concluído: OK
2026-01-13 10:31:42.063 | INFO     | watcher:process_job:129 - [36194-2026-01-13-10-22-00] Iniciando IA Validador 1…
2026-01-13 10:31:42.067 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 10:31:44.210 | ERROR    | doc_verifier_agent:validar_documentos_openai:113 - Erro ao validar via OpenAI: Error code: 400 - {'error': {'message': "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.", 'type': 'invalid_request_error', 'param': 'max_tokens', 'code': 'unsupported_parameter'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002172D7B2340>
    └ <Thread(ScriptRunner.scriptThread, started 400)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000002172D7B20C0>
    └ <Thread(ScriptRunner.scriptThread, started 400)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 400)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 400)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='301755d4-1cf3-4f8c-977d-921098b0eecd', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 400)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002172FF92DE0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000021730B945E0>
    └ ScriptRunner(_session_id='301755d4-1cf3-4f8c-977d-921098b0eecd', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='301755d4-1cf3-4f8c-977d-921098b0eecd', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002174E9ED4E0>
        └ <function exec_func_with_error_handling at 0x0000021730B0F740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002174E9ED4E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000217305A9600, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x00000217632ED3A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000217632ED260>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/36194-2026-01-13-10-22-00')
    └ <function process_job at 0x00000217632ED1C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 130, in process_job
    ia1_result = validar_documentos_openai(job_id, ocr_result.get("dados_extraidos", ""), manifest, modo="padrao")
                 │                         │       │          │                           └ {'job_id': '36194-2026-01-07-14-36-53', 'fornecedor_id': '20594257000126', 'perfil_validacao': 'PJ', 'contexto': {'razao_soci...
                 │                         │       │          └ <method 'get' of 'dict' objects>
                 │                         │       └ {'status': 'OK', 'job_id': '36194-2026-01-13-10-22-00', 'evidencias_dir': 'evidencias\\ocr\\36194-2026-01-13-10-22-00', 'dado...
                 │                         └ '36194-2026-01-13-10-22-00'
                 └ <function validar_documentos_openai at 0x000002173275C680>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 68, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000021764E2F1A0>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x00000217647D1FD0>
                 │      └ <openai.resources.chat.chat.Chat object at 0x00000217647D3E00>
                 └ <openai.OpenAI object at 0x00000217421FD7F0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentação Soc...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x00000217647D1FD0>,)
           └ <function Completions.create at 0x0000021764E2F060>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x00000217421FD7F0>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x00000217647D1FD0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000217333E36A0>
           │    │          └ <openai.OpenAI object at 0x00000217421FD7F0>
           │    └ ~ResponseT
           └ <function cast at 0x000002172D8093A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000217333E1E40>
          └ <openai.OpenAI object at 0x00000217421FD7F0>

openai.BadRequestError: Error code: 400 - {'error': {'message': "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.", 'type': 'invalid_request_error', 'param': 'max_tokens', 'code': 'unsupported_parameter'}}
2026-01-13 10:31:44.224 | INFO     | watcher:process_job:131 - [36194-2026-01-13-10-22-00] IA1 concluída: ERRO
2026-01-13 10:31:44.224 | INFO     | watcher:process_job:134 - [36194-2026-01-13-10-22-00] Consultando dados ReceitaWS…
2026-01-13 10:31:44.228 | INFO     | watcher:_stage_manifest_for_serpro:92 - [36194-2026-01-13-10-22-00] Manifest staged para ReceitaWS: outbox/36194-2026-01-13-10-22-00/serpro/manifest_for_serpro.json
2026-01-13 10:31:45.176 | INFO     | watcher:process_job:140 - [36194-2026-01-13-10-22-00] ReceitaWS concluída: OK
2026-01-13 10:31:45.177 | INFO     | watcher:process_job:143 - [36194-2026-01-13-10-22-00] Iniciando IA Validador 2 (comparativa)…
2026-01-13 10:31:45.179 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 10:31:46.448 | ERROR    | doc_verifier_agent:validar_documentos_openai:113 - Erro ao validar via OpenAI: Error code: 400 - {'error': {'message': "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.", 'type': 'invalid_request_error', 'param': 'max_tokens', 'code': 'unsupported_parameter'}}
Traceback (most recent call last):

  File "C:\Python313\Lib\threading.py", line 1014, in _bootstrap
    self._bootstrap_inner()
    │    └ <function Thread._bootstrap_inner at 0x000002172D7B2340>
    └ <Thread(ScriptRunner.scriptThread, started 400)>
  File "C:\Python313\Lib\threading.py", line 1043, in _bootstrap_inner
    self.run()
    │    └ <function Thread.run at 0x000002172D7B20C0>
    └ <Thread(ScriptRunner.scriptThread, started 400)>
  File "C:\Python313\Lib\threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {}
    │    │        │    │        └ <Thread(ScriptRunner.scriptThread, started 400)>
    │    │        │    └ ()
    │    │        └ <Thread(ScriptRunner.scriptThread, started 400)>
    │    └ <bound method ScriptRunner._run_script_thread of ScriptRunner(_session_id='301755d4-1cf3-4f8c-977d-921098b0eecd', _main_scrip...
    └ <Thread(ScriptRunner.scriptThread, started 400)>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 378, in _run_script_thread
    self._run_script(request.rerun_data)
    │    │           │       └ <property object at 0x000002172FF92DE0>
    │    │           └ ScriptRequest(type=<ScriptRequestType.RERUN: 'RERUN'>, _rerun_data=RerunData(widget_states=, context_info=timezone: "America/...
    │    └ <function ScriptRunner._run_script at 0x0000021730B945E0>
    └ ScriptRunner(_session_id='301755d4-1cf3-4f8c-977d-921098b0eecd', _main_script_path='main.py', _session_state={}, _uploaded_fi...
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 685, in _run_script
    ) = exec_func_with_error_handling(code_to_exec, ctx)
        │                             │             └ ScriptRunContext(session_id='301755d4-1cf3-4f8c-977d-921098b0eecd', _enqueue=<bound method ScriptRunner._enqueue_forward_msg ...
        │                             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002174E9ED4E0>
        └ <function exec_func_with_error_handling at 0x0000021730B0F740>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             └ <function ScriptRunner._run_script.<locals>.code_to_exec at 0x000002174E9ED4E0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 669, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
         │     │      └ <member '__dict__' of 'module' objects>
         │     └ <module '__main__' from 'main.py'>
         └ <code object <module> at 0x00000217305A9600, file "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OC...

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 158, in <module>
    main()
    └ <function main at 0x00000217632ED3A0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\main.py", line 155, in main
    detect_and_move_jobs(run_once=False)
    └ <function detect_and_move_jobs at 0x00000217632ED260>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 177, in detect_and_move_jobs
    process_job(job_dir)
    │           └ WindowsPath('inbox/36194-2026-01-13-10-22-00')
    └ <function process_job at 0x00000217632ED1C0>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py", line 149, in process_job
    ia2_result = validar_documentos_openai(job_id, json.dumps(entrada_ia2, ensure_ascii=False), manifest, modo="comparativo")
                 │                         │       │    │     │                                 └ {'job_id': '36194-2026-01-07-14-36-53', 'fornecedor_id': '20594257000126', 'perfil_validacao': 'PJ', 'contexto': {'razao_soci...
                 │                         │       │    │     └ {'dados_ocr': '\n\n# cnpj_cadi.pdf (Tesseract)\n\n\n--- Página 1 ---\n06/01/26, 16:13 about:blank\nsólo REPUBLICA FEDERATIVA ...
                 │                         │       │    └ <function dumps at 0x000002172D80E8E0>
                 │                         │       └ <module 'json' from 'C:\\Python313\\Lib\\json\\__init__.py'>
                 │                         └ '36194-2026-01-13-10-22-00'
                 └ <function validar_documentos_openai at 0x000002173275C680>

> File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\doc_verifier_agent.py", line 68, in validar_documentos_openai
    completion = client.chat.completions.create(
                 │      │    │           └ <function Completions.create at 0x0000021764E2F1A0>
                 │      │    └ <openai.resources.chat.completions.completions.Completions object at 0x000002170071CE10>
                 │      └ <openai.resources.chat.chat.Chat object at 0x000002170071CF50>
                 └ <openai.OpenAI object at 0x000002170071ED50>

  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_utils\_utils.py", line 286, in wrapper
    return func(*args, **kwargs)
           │     │       └ {'model': 'gpt-5', 'messages': [{'role': 'system', 'content': '## 1) System\nVocê é um **Validador Sênior de Documentação Soc...
           │     └ (<openai.resources.chat.completions.completions.Completions object at 0x000002170071CE10>,)
           └ <function Completions.create at 0x0000021764E2F060>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 1156, in create
    return self._post(
           │    └ <bound method SyncAPIClient.post of <openai.OpenAI object at 0x000002170071ED50>>
           └ <openai.resources.chat.completions.completions.Completions object at 0x000002170071CE10>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
           │    │          │    │       │        │            │                  └ openai.Stream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
           │    │          │    │       │        │            └ False
           │    │          │    │       │        └ FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
           │    │          │    │       └ <class 'openai.types.chat.chat_completion.ChatCompletion'>
           │    │          │    └ <function SyncAPIClient.request at 0x00000217333E36A0>
           │    │          └ <openai.OpenAI object at 0x000002170071ED50>
           │    └ ~ResponseT
           └ <function cast at 0x000002172D8093A0>
  File "C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\.venv\Lib\site-packages\openai\_base_client.py", line 1047, in request
    raise self._make_status_error_from_response(err.response) from None
          │    └ <function BaseClient._make_status_error_from_response at 0x00000217333E1E40>
          └ <openai.OpenAI object at 0x000002170071ED50>

openai.BadRequestError: Error code: 400 - {'error': {'message': "Unsupported parameter: 'max_tokens' is not supported with this model. Use 'max_completion_tokens' instead.", 'type': 'invalid_request_error', 'param': 'max_tokens', 'code': 'unsupported_parameter'}}
2026-01-13 10:31:46.455 | INFO     | watcher:process_job:150 - [36194-2026-01-13-10-22-00] IA2 concluída: ERRO
2026-01-13 10:31:46.455 | INFO     | watcher:process_job:153 - [36194-2026-01-13-10-22-00] Gerando relatório final…
2026-01-13 10:31:46.463 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\36194-2026-01-13-10-22-00\resultado
2026-01-13 10:31:46.463 | INFO     | watcher:process_job:155 - [36194-2026-01-13-10-22-00] Relatório final gerado.
2026-01-13 10:31:46.465 | INFO     | log_service:registrar_evento:205 - [WATCHER] Pipeline concluído com sucesso
2026-01-13 10:42:11.989 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:23.962 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:23.980 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:24.005 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:24.022 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:24.024 | INFO     | consulta_serpro:<module>:20 - ReceitaWS MODE ATIVO — consulta_serpro.py (build 2025-11-05) | file=%s
2026-01-13 10:42:24.041 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:24.042 | INFO     | watcher:<module>:20 - watcher.py carregado de: C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Licitanet_OCR_OpenAI_V2\watcher.py
2026-01-13 10:42:24.058 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:24.068 | ERROR    | log_service:safe_mkdir:71 - ERRO DE PERMISSÃO EM inbox: O sistema não consegue escrever nesta pasta. Verifique se o Windows ou OneDrive está bloqueando o acesso. Erro: [WinError 32] O arquivo já está sendo usado por outro processo: 'inbox\\.perm_test_22088'
2026-01-13 10:42:24.096 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-01-13 10:42:24.098 | INFO     | __main__:main:143 - Estrutura de diretórios verificada:
2026-01-13 10:42:24.280 | INFO     | __main__:main:154 - Modo PRODUÇÃO - monitoramento contínuo iniciado.
2026-01-13 10:42:24.358 | INFO     | watcher:detect_and_move_jobs:171 - Iniciando monitoramento do diretório /inbox …
2026-01-13 10:42:24.562 | INFO     | watcher:detect_and_move_jobs:175 - 1 job(s) detectado(s) em /inbox.
2026-01-13 10:42:24.563 | INFO     | log_service:registrar_evento:205 - [WATCHER] Novo job detectado em inbox: inbox/36194-2026-01-13-10-41-00
2026-01-13 10:42:24.850 | INFO     | log_service:registrar_evento:205 - [WATCHER] Job movido para processing: processing/36194-2026-01-13-10-41-00
2026-01-13 10:42:24.854 | INFO     | manifest_loader:load_manifest:218 - [MANIFEST] Tentando carregar: processing\36194-2026-01-13-10-41-00\manifest.json (exists=True)
2026-01-13 10:42:24.858 | INFO     | manifest_loader:_load_external_schema_if_exists:82 - Schema externo encontrado em schemas/manifest_v3.json
2026-01-13 10:42:24.862 | INFO     | manifest_loader:load_manifest:256 - Manifest carregado e normalizado para job_dir='processing/36194-2026-01-13-10-41-00' → 'manifest.normalizado.json'
2026-01-13 10:42:24.863 | WARNING  | watcher:process_job:121 - [36194-2026-01-13-10-41-00] job_id no manifest difere do nome da pasta. Prosseguindo assim mesmo.
2026-01-13 10:42:24.863 | INFO     | watcher:process_job:124 - [36194-2026-01-13-10-41-00] Iniciando OCR/Docling…
2026-01-13 10:42:24.868 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 3 arquivos.
2026-01-13 10:42:24.870 | INFO     | ocr_router:executar_ocr:71 - Roteando cnpj_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 10:42:36.037 | INFO     | ocr_router:executar_ocr:71 - Roteando alteracao_contratual_cadi.pdf para Pipeline Padrão (Docling).
2026-01-13 10:48:27.149 | INFO     | ocr_router:executar_ocr:71 - Roteando rg_camila.pdf para Pipeline Padrão (Docling).
2026-01-13 10:49:34.068 | INFO     | watcher:process_job:126 - [36194-2026-01-13-10-41-00] OCR/Docling concluído: OK
2026-01-13 10:49:34.069 | INFO     | watcher:process_job:129 - [36194-2026-01-13-10-41-00] Iniciando IA Validador 1…
2026-01-13 10:49:34.074 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 10:50:08.628 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para 36194-2026-01-13-10-41-00 (padrao)
2026-01-13 10:50:08.629 | INFO     | watcher:process_job:131 - [36194-2026-01-13-10-41-00] IA1 concluída: OK
2026-01-13 10:50:08.629 | INFO     | watcher:process_job:134 - [36194-2026-01-13-10-41-00] Consultando dados ReceitaWS…
2026-01-13 10:50:08.632 | INFO     | watcher:_stage_manifest_for_serpro:92 - [36194-2026-01-13-10-41-00] Manifest staged para ReceitaWS: outbox/36194-2026-01-13-10-41-00/serpro/manifest_for_serpro.json
2026-01-13 10:50:09.764 | INFO     | watcher:process_job:140 - [36194-2026-01-13-10-41-00] ReceitaWS concluída: OK
2026-01-13 10:50:09.764 | INFO     | watcher:process_job:143 - [36194-2026-01-13-10-41-00] Iniciando IA Validador 2 (comparativa)…
2026-01-13 10:50:09.767 | INFO     | doc_verifier_agent:validar_documentos_openai:64 - Enviando análise para OpenAI (PJ)...
2026-01-13 10:50:25.252 | INFO     | doc_verifier_agent:validar_documentos_openai:97 - Validação IA concluída para 36194-2026-01-13-10-41-00 (comparativo)
2026-01-13 10:50:25.252 | INFO     | watcher:process_job:150 - [36194-2026-01-13-10-41-00] IA2 concluída: OK
2026-01-13 10:50:25.253 | INFO     | watcher:process_job:153 - [36194-2026-01-13-10-41-00] Gerando relatório final…
2026-01-13 10:50:25.260 | INFO     | relatorio:gerar_relatorio_final:86 - Relatórios finais gerados em outbox\36194-2026-01-13-10-41-00\resultado
2026-01-13 10:50:25.261 | INFO     | watcher:process_job:155 - [36194-2026-01-13-10-41-00] Relatório final gerado.
2026-01-13 10:50:25.263 | INFO     | log_service:registrar_evento:205 - [WATCHER] Pipeline concluído com sucesso
2026-02-12 19:04:11.005 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-02-12 19:04:31.088 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-02-12 19:04:31.101 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-02-12 19:04:31.104 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 2 arquivos.
2026-02-12 19:04:31.105 | INFO     | ocr_router:executar_ocr:71 - Roteando C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Dados\Teste_1202\done\WhatsApp Image 2026-02-10 at 08.51.38 (1).jpeg para Pipeline Padrão (Docling).
2026-02-12 19:05:11.409 | WARNING  | extrator_docling:extrair_com_tesseract:135 - Erro no OCR Tesseract: Unable to get page count.
Syntax Warning: May not be a PDF file (continuing anyway)
Syntax Error: Couldn't find trailer dictionary
Syntax Error: Couldn't find trailer dictionary
Syntax Error: Couldn't read xref table

2026-02-12 19:05:11.420 | INFO     | ocr_router:executar_ocr:71 - Roteando C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Dados\Teste_1202\done\WhatsApp Image 2026-02-10 at 08.51.38.jpeg para Pipeline Padrão (Docling).
2026-02-12 19:05:39.468 | WARNING  | extrator_docling:extrair_com_tesseract:135 - Erro no OCR Tesseract: Unable to get page count.
Syntax Warning: May not be a PDF file (continuing anyway)
Syntax Error: Couldn't find trailer dictionary
Syntax Error: Couldn't find trailer dictionary
Syntax Error: Couldn't read xref table

2026-02-12 19:07:23.669 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-02-12 19:07:41.014 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-02-12 19:07:41.023 | INFO     | log_service:init_folders:160 - Estrutura de diretórios inicializada com sucesso.
2026-02-12 19:07:41.026 | INFO     | ocr_router:executar_ocr:28 - Iniciando OCR para 2 arquivos.
2026-02-12 19:07:41.027 | INFO     | ocr_router:executar_ocr:71 - Roteando C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Dados\Teste_1202\done\WhatsApp Image 2026-02-10 at 08.51.38 (1).jpeg para Pipeline Padrão (Docling).
2026-02-12 19:08:17.325 | INFO     | ocr_router:executar_ocr:71 - Roteando C:\Users\walte\OneDrive\Workspace\IA\LICITANET\Projeto_Valida\Dados\Teste_1202\done\WhatsApp Image 2026-02-10 at 08.51.38.jpeg para Pipeline Padrão (Docling).
