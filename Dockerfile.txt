# =====================================================
# ğŸ³ Dockerfile â€” LICITANET + OCR + OPENAI
# Baseado em Python 3.11 Slim
# =====================================================
FROM python:3.11-slim

# DiretÃ³rio de trabalho dentro do container
WORKDIR /app

# =====================================================
# ğŸ”§ ConfiguraÃ§Ãµes bÃ¡sicas
# =====================================================
# Evita cache pesado do pip e define variÃ¡veis de ambiente
ENV PIP_NO_CACHE_DIR=1 \
    PYTHONUNBUFFERED=1 \
    TZ=America/Sao_Paulo

# Instala dependÃªncias do sistema necessÃ¡rias ao Tesseract, pdf2image e compilaÃ§Ã£o
RUN apt-get update && apt-get install -y \
    tesseract-ocr \
    poppler-utils \
    libgl1-mesa-glx \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# =====================================================
# ğŸ“¦ Instala dependÃªncias Python
# =====================================================
# Copia apenas o requirements para cache otimizado
COPY requirements.txt .
RUN pip install --upgrade pip && pip install -r requirements.txt

# =====================================================
# ğŸ“ Copia todo o projeto
# =====================================================
COPY . .

# =====================================================
# ğŸŒ ExposiÃ§Ã£o de portas
# =====================================================
# Streamlit utiliza por padrÃ£o a porta 8501
EXPOSE 8501

# =====================================================
# ğŸš€ Comando padrÃ£o de execuÃ§Ã£o
# =====================================================
# Para rodar interface Streamlit (frontend):
# CMD ["streamlit", "run", "interface_frontend.py", "--server.port=8501", "--server.address=0.0.0.0"]

# Para rodar pipeline automÃ¡tico (modo produÃ§Ã£o):
CMD ["python", "main.py"]
